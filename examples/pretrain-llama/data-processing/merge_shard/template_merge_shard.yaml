# Training job submission via AML CLI v2

$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json

command: >-
  bash examples/pretrain-llama/data-processing/merge_shard/remote_merge_shard.sh \
    ar_trans_wiki_0 \
    ${{inputs.data_1}} \
    ${{inputs.data_2}} \
  

display_name: merge_shard

experiment_name: tokenize
code: ../../../../
environment: azureml:Megatron-LLaMA:7
environment_variables:
  HYDRA_FULL_ERROR: '1'
  UCX_IB_PCI_RELAXED_ORDERING: 'auto'
  NCCL_IB_PCI_RELAXED_ORDERING: '2'
  NCCL_IB_TIMEOUT: '22'
  NCCL_DEBUG: WARN
  CUDA_DEVICE_MAX_CONNECTIONS: '1'

services:
  my_jupyterlab:
    type: jupyter_lab
    nodes: all

compute: azureml:LARGE-CPU

distribution:
  type: pytorch
  process_count_per_instance: 1

resources:
  instance_count: 1
  shm_size: 100g