$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
code: ../../
command: bash examples/pretrain-llama/data-processing/tokenize/remote_az_batch_tokenize.sh  "ar_translated_peS20_008.jsonl"
  "https://allamllmuksstandard.blob.core.windows.net/vocab-expanded-training-data/processed/merged_shards"
  "https://allamllmuksstandard.blob.core.windows.net/vocab-expanded-training-data/allam_data_2-1_splits-llama2-indexed_data/llama2_bin_idx_trans/"
  "Llama2Tokenizer" "https://allamllmuksstandard.blob.core.windows.net/vocab-expanded-training-data/allam_data_2-1_splits-llama2-indexed_data/tokenizer/tokenizer.model"
  "16" "10000" "sp=racwdli&st=2023-11-26T15:25:43Z&se=2023-11-26T23:25:43Z&spr=https&sv=2022-11-02&sr=c&sig=GeRcxL%2Bvl%2FCyis3P0Gmu8qFJY8jLdu5zyswbDfNPKb4%3D"
compute: azureml:LARGE-CPU
display_name: tokenize
distribution:
  process_count_per_instance: 1
  type: pytorch
environment: azureml:Megatron-LLaMA:7
environment_variables:
  CUDA_DEVICE_MAX_CONNECTIONS: '1'
  HYDRA_FULL_ERROR: '1'
  NCCL_DEBUG: WARN
  NCCL_IB_PCI_RELAXED_ORDERING: '2'
  NCCL_IB_TIMEOUT: '22'
  UCX_IB_PCI_RELAXED_ORDERING: auto
experiment_name: tokenize
inputs:
  data:
    mode: ro_mount
    path: azureml://subscriptions/c7209a17-0d9f-41df-8e45-e0172343698d/resourcegroups/llm-test/workspaces/Provisioning-Test/datastores/llama_pretraining/paths/processed/ar/translated
    type: uri_folder
  tokenizer:
    mode: ro_mount
    path: azureml://subscriptions/c7209a17-0d9f-41df-8e45-e0172343698d/resourcegroups/llm-test/workspaces/Provisioning-Test/datastores/llama_pretraining/paths/allam_data_2-1_splits-llama2-VE-indexed_data/tokenizer/tokenizer.model
    type: uri_file
outputs:
  bin_idx_path:
    mode: rw_mount
    path: azureml://subscriptions/c7209a17-0d9f-41df-8e45-e0172343698d/resourcegroups/llm-test/workspaces/Provisioning-Test/datastores/llama_pretraining/paths/allam_data_2-1_splits-llama2-VE-indexed_data/bin_idx/
    type: uri_folder
resources:
  instance_count: 1
  shm_size: 100g
services:
  my_jupyterlab:
    nodes: all
    type: jupyter_lab
