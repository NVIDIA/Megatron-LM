Warning: Permanently added '[192.168.0.87]:46844' (ECDSA) to the list of known hosts.
Warning: Permanently added '[192.168.0.71]:43529' (ECDSA) to the list of known hosts.
Warning: Permanently added '[192.168.0.34]:45820' (ECDSA) to the list of known hosts.
[1,7]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,7]<stdout>:Detected CUDA files, patching ldflags
[1,7]<stdout>:Emitting ninja build file /home/amawa/.cache/torch_extensions/transformer_inference/build.ninja...
[1,7]<stdout>:Building extension module transformer_inference...
[1,7]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,7]<stdout>:ninja: no work to do.
[1,7]<stdout>:Loading extension module transformer_inference...
[1,7]<stdout>:Time to load transformer_inference op: 0.26534271240234375 seconds
[1,6]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:Detected CUDA files, patching ldflags
[1,6]<stdout>:Emitting ninja build file /home/amawa/.cache/torch_extensions/transformer_inference/build.ninja...
[1,6]<stdout>:Building extension module transformer_inference...
[1,6]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,2]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,3]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:ninja: no work to do.
[1,1]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:Loading extension module transformer_inference...
[1,6]<stdout>:Time to load transformer_inference op: 0.348391056060791 seconds
[1,31]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:Detected CUDA files, patching ldflags
[1,0]<stdout>:Emitting ninja build file /home/amawa/.cache/torch_extensions/transformer_inference/build.ninja...
[1,0]<stdout>:Building extension module transformer_inference...
[1,0]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,0]<stdout>:ninja: no work to do.
[1,24]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:Loading extension module transformer_inference...
[1,0]<stdout>:Time to load transformer_inference op: 0.25952601432800293 seconds
[1,2]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:Time to load transformer_inference op: 0.3723154067993164 seconds
[1,30]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:Loading extension module transformer_inference...
[1,4]<stdout>:Time to load transformer_inference op: 0.35916566848754883 seconds
[1,13]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:Loading extension module transformer_inference...
[1,25]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:Time to load transformer_inference op: 0.3549232482910156 seconds
[1,3]<stdout>:Loading extension module transformer_inference...
[1,3]<stdout>:Time to load transformer_inference op: 0.3484206199645996 seconds
[1,1]<stdout>:Loading extension module transformer_inference...
[1,1]<stdout>:Time to load transformer_inference op: 0.33397626876831055 seconds
[1,29]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,30]<stdout>:Detected CUDA files, patching ldflags
[1,30]<stdout>:Emitting ninja build file /home/amawa/.cache/torch_extensions/transformer_inference/build.ninja...
[1,27]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,28]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,26]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,7]<stdout>:[2021-12-09 02:31:28,760] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,12]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,10]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,14]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:[2021-12-09 02:31:28,800] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,8]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,15]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,11]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,9]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,30]<stdout>:Building extension module transformer_inference...
[1,30]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,30]<stdout>:ninja: no work to do.
[1,0]<stdout>:using world size: 32, data-parallel-size: 32, tensor-model-parallel size: 1, pipeline-model-parallel size: 1 
[1,0]<stdout>:WARNING: overriding default arguments for tokenizer_type:GPT2BPETokenizer                        with tokenizer_type:GPT2BPETokenizer
[1,0]<stdout>:setting global batch size to 256[1,0]<stdout>:
[1,0]<stdout>:using torch.float16 for parameters ...
[1,0]<stdout>:------------------------ arguments ------------------------
[1,0]<stdout>:  accumulate_allreduce_grads_in_fp32 .............. False
[1,0]<stdout>:  adam_beta1 ...................................... 0.9
[1,0]<stdout>:  adam_beta2 ...................................... 0.999
[1,0]<stdout>:  adam_eps ........................................ 1e-08
[1,0]<stdout>:  adlr_autoresume ................................. False
[1,0]<stdout>:  adlr_autoresume_interval ........................ 1000
[1,0]<stdout>:  apply_query_key_layer_scaling ................... True
[1,0]<stdout>:  apply_residual_connection_post_layernorm ........ False
[1,0]<stdout>:  attention_dropout ............................... 0.1
[1,0]<stdout>:  attention_softmax_in_fp32 ....................... False
[1,0]<stdout>:  bert_binary_head ................................ True[1,0]<stdout>:
[1,0]<stdout>:  bert_load ....................................... None
[1,0]<stdout>:  bf16 ............................................ False
[1,0]<stdout>:  bias_dropout_fusion ............................. True
[1,0]<stdout>:  bias_gelu_fusion ................................ True
[1,0]<stdout>:  biencoder_projection_dim ........................ 0
[1,0]<stdout>:  biencoder_shared_query_context_model ............ False
[1,0]<stdout>:  block_data_path ................................. None
[1,0]<stdout>:  checkpoint_activations .......................... False
[1,0]<stdout>:  checkpoint_in_cpu ............................... False[1,0]<stdout>:
[1,0]<stdout>:  checkpoint_num_layers ........................... 1
[1,0]<stdout>:  clip_grad ....................................... 1.0
[1,0]<stdout>:  consumed_train_samples .......................... 0
[1,0]<stdout>:  consumed_train_tokens ........................... 0[1,0]<stdout>:
[1,0]<stdout>:  consumed_valid_samples .......................... 0
[1,0]<stdout>:  contigious_checkpointing ........................ False
[1,0]<stdout>:  cpu_optimizer ................................... False
[1,0]<stdout>:  cpu_torch_adam .................................. False
[1,0]<stdout>:  curriculum_learning ............................. False
[1,0]<stdout>:  data_impl ....................................... infer
[1,0]<stdout>:  data_parallel_size .............................. 32
[1,0]<stdout>:  data_path ....................................... None
[1,0]<stdout>:  dataloader_type ................................. single
[1,0]<stdout>:  DDP_impl ........................................ local
[1,0]<stdout>:  decoder_seq_length .............................. None
[1,0]<stdout>:  deepscale ....................................... False
[1,0]<stdout>:  deepscale_config ................................ None
[1,0]<stdout>:  deepspeed ....................................... True
[1,0]<stdout>:  deepspeed_activation_checkpointing .............. False[1,0]<stdout>:
[1,0]<stdout>:  deepspeed_config ................................ None
[1,0]<stdout>:  deepspeed_mpi ................................... False[1,0]<stdout>:
[1,0]<stdout>:  distribute_checkpointed_activations ............. False
[1,0]<stdout>:  distributed_backend ............................. nccl
[1,0]<stdout>:  ds_inference .................................... True
[1,0]<stdout>:  embedding_path .................................. None
[1,0]<stdout>:  encoder_seq_length .............................. 30[1,0]<stdout>:
[1,0]<stdout>:  eod_mask_loss ................................... False
[1,0]<stdout>:  eval_interval ................................... 1000
[1,0]<stdout>:  eval_iters ...................................... 100
[1,0]<stdout>:  evidence_data_path .............................. None
[1,0]<stdout>:  exit_duration_in_mins ........................... None
[1,0]<stdout>:  exit_interval ................................... None
[1,0]<stdout>:  expert_interval ................................. 2
[1,0]<stdout>:  ffn_hidden_size ................................. 16384[1,0]<stdout>:
[1,0]<stdout>:  finetune ........................................ False
[1,0]<stdout>:  fp16 ............................................ True
[1,0]<stdout>:  fp16_lm_cross_entropy ........................... False
[1,0]<stdout>:  fp32_residual_connection ........................ False
[1,0]<stdout>:  genfile ......................................... unconditional_samples.json
[1,0]<stdout>:  global_batch_size ............................... 256
[1,0]<stdout>:  greedy .......................................... False[1,0]<stdout>:
[1,0]<stdout>:  hidden_dropout .................................. 0.1[1,0]<stdout>:
[1,0]<stdout>:  hidden_size ..................................... 4096
[1,0]<stdout>:  hysteresis ...................................... 2
[1,0]<stdout>:  ict_head_size ................................... None
[1,0]<stdout>:  ict_load ........................................ None
[1,0]<stdout>:  img_dim ......................................... 224
[1,0]<stdout>:  indexer_batch_size .............................. 128[1,0]<stdout>:
[1,0]<stdout>:  indexer_log_interval ............................ 1000
[1,0]<stdout>:  init_method_std ................................. 0.02
[1,0]<stdout>:  init_method_xavier_uniform ...................... False
[1,0]<stdout>:  initial_loss_scale .............................. 4294967296
[1,0]<stdout>:  kv_channels ..................................... 128
[1,0]<stdout>:  layernorm_epsilon ............................... 1e-05
[1,0]<stdout>:  lazy_mpu_init ................................... None
[1,0]<stdout>:  load ............................................ checkpoints/gpt2_345m
[1,0]<stdout>:  local_rank ...................................... None[1,0]<stdout>:
[1,0]<stdout>:  log_batch_size_to_tensorboard ................... False
[1,0]<stdout>:  log_interval .................................... 1[1,0]<stdout>:
[1,0]<stdout>:  log_learning_rate_to_tensorboard ................ True
[1,0]<stdout>:  log_loss_scale_to_tensorboard ................... True
[1,0]<stdout>:  log_num_zeros_in_grad ........................... False
[1,0]<stdout>:  log_params_norm ................................. False
[1,0]<stdout>:  log_timers_to_tensorboard ....................... False
[1,0]<stdout>:  log_validation_ppl_to_tensorboard ............... False[1,0]<stdout>:
[1,0]<stdout>:  loss_scale ...................................... None
[1,0]<stdout>:  loss_scale_window ............................... 1000[1,0]<stdout>:
[1,0]<stdout>:  lr .............................................. None
[1,0]<stdout>:  lr_decay_iters .................................. None
[1,0]<stdout>:  lr_decay_samples ................................ None
[1,0]<stdout>:  lr_decay_style .................................. linear
[1,0]<stdout>:  lr_decay_tokens ................................. None
[1,0]<stdout>:  lr_warmup_fraction .............................. None
[1,0]<stdout>:  lr_warmup_iters ................................. 0
[1,0]<stdout>:  lr_warmup_samples ............................... 0[1,0]<stdout>:
[1,0]<stdout>:  make_vocab_size_divisible_by .................... 128
[1,0]<stdout>:  mask_prob ....................................... 0.15
[1,0]<stdout>:  masked_softmax_fusion ........................... True
[1,0]<stdout>:  max_position_embeddings ......................... 1024
[1,0]<stdout>:  memory_centric_tiled_linear ..................... False
[1,0]<stdout>:  merge_file ...................................... gpt2-merges.txt
[1,0]<stdout>:  micro_batch_size ................................ 8
[1,0]<stdout>:  min_loss_scale .................................. 1.0
[1,0]<stdout>:  min_lr .......................................... 0.0
[1,0]<stdout>:  mmap_warmup ..................................... False
[1,0]<stdout>:  moe_eval_capacity_factor ........................ 1.0
[1,0]<stdout>:  moe_min_capacity ................................ 4
[1,0]<stdout>:  moe_token_dropping .............................. True[1,0]<stdout>:
[1,0]<stdout>:  moe_train_capacity_factor ....................... 1.0
[1,0]<stdout>:  no_load_optim ................................... True
[1,0]<stdout>:  no_load_rng ..................................... True
[1,0]<stdout>:  no_save_optim ................................... None
[1,0]<stdout>:  no_save_rng ..................................... None
[1,0]<stdout>:  num_attention_heads ............................. 32
[1,0]<stdout>:  num_channels .................................... 3
[1,0]<stdout>:  num_classes ..................................... 1000
[1,0]<stdout>:  num_experts ..................................... 128
[1,0]<stdout>:  num_layers ...................................... 40
[1,0]<stdout>:  num_layers_per_virtual_pipeline_stage ........... None
[1,0]<stdout>:  num_samples ..................................... 160
[1,0]<stdout>:  num_workers ..................................... 2
[1,0]<stdout>:  onnx_safe ....................................... None
[1,0]<stdout>:  openai_gelu ..................................... False
[1,0]<stdout>:  optimizer ....................................... adam
[1,0]<stdout>:  out_seq_length .................................. 30
[1,0]<stdout>:  override_lr_scheduler ........................... False
[1,0]<stdout>:  params_dtype .................................... torch.float16
[1,0]<stdout>:  partition_activations ........................... False
[1,0]<stdout>:  patch_dim ....................................... 16
[1,0]<stdout>:  pipeline_model_parallel_size .................... 1
[1,0]<stdout>:  profile_backward ................................ False[1,0]<stdout>:
[1,0]<stdout>:  query_in_block_prob ............................. 0.1
[1,0]<stdout>:  rampup_batch_size ............................... None
[1,0]<stdout>:  rank ............................................ 0
[1,0]<stdout>:  recompute ....................................... False
[1,0]<stdout>:  remote_device ................................... none[1,0]<stdout>:
[1,0]<stdout>:  reset_attention_mask ............................ False
[1,0]<stdout>:  reset_position_ids .............................. False
[1,0]<stdout>:  retriever_report_topk_accuracies ................ []
[1,0]<stdout>:  retriever_score_scaling ......................... False
[1,0]<stdout>:  retriever_seq_length ............................ 256
[1,0]<stdout>:  sample_input_file ............................... None[1,0]<stdout>:
[1,0]<stdout>:  sample_output_file .............................. None
[1,0]<stdout>:  sample_rate ..................................... 1.0
[1,0]<stdout>:  save ............................................ None
[1,0]<stdout>:  save_interval ................................... None
[1,0]<stdout>:  scatter_gather_tensors_in_pipeline .............. True
[1,0]<stdout>:  scattered_embeddings ............................ False
[1,0]<stdout>:  seed ............................................ 1234[1,0]<stdout>:
[1,0]<stdout>:  seq_length ...................................... 30
[1,0]<stdout>:  sgd_momentum .................................... 0.9
[1,0]<stdout>:  short_seq_prob .................................. 0.1
[1,0]<stdout>:  split ........................................... 969, 30, 1
[1,0]<stdout>:  split_transformers .............................. False
[1,0]<stdout>:  synchronize_each_layer .......................... False
[1,0]<stdout>:  temperature ..................................... 1.0
[1,0]<stdout>:  tensor_model_parallel_size ...................... 1
[1,0]<stdout>:  tensorboard_dir ................................. None
[1,0]<stdout>:  tensorboard_log_interval ........................ 1[1,0]<stdout>:
[1,0]<stdout>:  tensorboard_queue_size .......................... 1000
[1,0]<stdout>:  tile_factor ..................................... 1
[1,0]<stdout>:  titles_data_path ................................ None
[1,0]<stdout>:  tokenizer_type .................................. GPT2BPETokenizer
[1,0]<stdout>:  top_k ........................................... 0
[1,0]<stdout>:  top_p ........................................... 0.9
[1,0]<stdout>:  topk ............................................ 1
[1,0]<stdout>:  train_iters ..................................... None
[1,0]<stdout>:  train_samples ................................... None
[1,0]<stdout>:  train_tokens .................................... None
[1,0]<stdout>:  use_checkpoint_lr_scheduler ..................... False
[1,0]<stdout>:  use_contiguous_buffers_in_ddp ................... False
[1,0]<stdout>:  use_cpu_initialization .......................... None
[1,0]<stdout>:  use_one_sent_docs ............................... False
[1,0]<stdout>:  use_pin_memory .................................. False
[1,0]<stdout>:  virtual_pipeline_model_parallel_size ............ None
[1,0]<stdout>:  vocab_extra_ids ................................. 0
[1,0]<stdout>:  vocab_file ...................................... gpt2-vocab.json
[1,0]<stdout>:  weight_decay .................................... 0.01
[1,0]<stdout>:  world_size ...................................... 32
[1,0]<stdout>:  zero_allgather_bucket_size ...................... 0.0
[1,0]<stdout>:  zero_contigious_gradients ....................... False
[1,0]<stdout>:  zero_reduce_bucket_size ......................... 0.0
[1,0]<stdout>:  zero_reduce_scatter ............................. False
[1,0]<stdout>:  zero_stage ...................................... 1.0
[1,0]<stdout>:-------------------- end of arguments ---------------------
[1,0]<stdout>:setting number of micro-batches to constant 1
[1,0]<stdout>:> building GPT2BPETokenizer tokenizer ...
[1,30]<stdout>:Loading extension module transformer_inference...
[1,29]<stdout>:Loading extension module transformer_inference...
[1,30]<stdout>:Time to load transformer_inference op: 0.44675612449645996 seconds
[1,29]<stdout>:Time to load transformer_inference op: 0.3623991012573242 seconds
[1,27]<stdout>:Loading extension module transformer_inference...
[1,27]<stdout>:Time to load transformer_inference op: 0.3436441421508789 seconds
[1,28]<stdout>:Loading extension module transformer_inference...
[1,24]<stdout>:Loading extension module transformer_inference...
[1,28]<stdout>:Time to load transformer_inference op: 0.3162803649902344 seconds
[1,24]<stdout>:Time to load transformer_inference op: 0.502415657043457 seconds
[1,26]<stdout>:Loading extension module transformer_inference...
[1,26]<stdout>:Time to load transformer_inference op: 0.30908823013305664 seconds
[1,31]<stdout>:Loading extension module transformer_inference...
[1,31]<stdout>:Time to load transformer_inference op: 0.6049556732177734 seconds
[1,2]<stdout>:[2021-12-09 02:31:28,953] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,0]<stdout>: > padded vocab (size: 50257) with 47 dummy tokens (new size: 50304)
[1,0]<stdout>:> initializing torch distributed ...
[1,0]<stdout>:[2021-12-09 02:31:28,964] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,4]<stdout>:[2021-12-09 02:31:28,974] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,5]<stdout>:[2021-12-09 02:31:28,976] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,25]<stdout>:Loading extension module transformer_inference...
[1,25]<stdout>:Time to load transformer_inference op: 0.48375844955444336 seconds
[1,3]<stdout>:[2021-12-09 02:31:28,995] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,1]<stdout>:[2021-12-09 02:31:29,003] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,23]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,16]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,23]<stdout>:Detected CUDA files, patching ldflags
[1,23]<stdout>:Emitting ninja build file /home/amawa/.cache/torch_extensions/transformer_inference/build.ninja...
[1,22]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,23]<stdout>:Building extension module transformer_inference...
[1,23]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,30]<stdout>:[2021-12-09 02:31:29,225] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,29]<stdout>:[2021-12-09 02:31:29,227] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,24]<stdout>:[2021-12-09 02:31:29,238] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,27]<stdout>:[2021-12-09 02:31:29,240] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,28]<stdout>:[2021-12-09 02:31:29,241] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,26]<stdout>:[2021-12-09 02:31:29,241] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,17]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,21]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,23]<stdout>:ninja: no work to do.
[1,31]<stdout>:[2021-12-09 02:31:29,266] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,19]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,23]<stdout>:Loading extension module transformer_inference...
[1,18]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,25]<stdout>:[2021-12-09 02:31:29,280] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,20]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,23]<stdout>:Time to load transformer_inference op: 0.4067070484161377 seconds
[1,19]<stdout>:Detected CUDA files, patching ldflags
[1,19]<stdout>:Emitting ninja build file /home/amawa/.cache/torch_extensions/transformer_inference/build.ninja...
[1,19]<stdout>:Building extension module transformer_inference...
[1,19]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,19]<stdout>:ninja: no work to do.
[1,19]<stdout>:Loading extension module transformer_inference...
[1,19]<stdout>:Time to load transformer_inference op: 0.32187390327453613 seconds
[1,17]<stdout>:Loading extension module transformer_inference...
[1,16]<stdout>:Loading extension module transformer_inference...
[1,17]<stdout>:Time to load transformer_inference op: 0.3866918087005615 seconds
[1,16]<stdout>:Time to load transformer_inference op: 0.5429811477661133 seconds
[1,21]<stdout>:Loading extension module transformer_inference...
[1,21]<stdout>:Time to load transformer_inference op: 0.3820228576660156 seconds
[1,18]<stdout>:Loading extension module transformer_inference...
[1,20]<stdout>:Loading extension module transformer_inference...
[1,18]<stdout>:Time to load transformer_inference op: 0.37206125259399414 seconds
[1,20]<stdout>:Time to load transformer_inference op: 0.35692358016967773 seconds
[1,22]<stdout>:Loading extension module transformer_inference...
[1,22]<stdout>:Time to load transformer_inference op: 0.5176739692687988 seconds
[1,23]<stdout>:[2021-12-09 02:31:29,705] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,19]<stdout>:[2021-12-09 02:31:29,730] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,16]<stdout>:[2021-12-09 02:31:29,753] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,17]<stdout>:[2021-12-09 02:31:29,759] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,21]<stdout>:[2021-12-09 02:31:29,779] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,18]<stdout>:[2021-12-09 02:31:29,803] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,20]<stdout>:[2021-12-09 02:31:29,807] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,22]<stdout>:[2021-12-09 02:31:29,813] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,9]<stdout>:Loading extension module transformer_inference...
[1,9]<stdout>:Time to load transformer_inference op: 3.143354654312134 seconds
[1,13]<stdout>:Loading extension module transformer_inference...
[1,12]<stdout>:Loading extension module transformer_inference...
[1,13]<stdout>:Time to load transformer_inference op: 3.437814235687256 seconds
[1,12]<stdout>:Time to load transformer_inference op: 3.296391725540161 seconds
[1,10]<stdout>:Loading extension module transformer_inference...
[1,10]<stdout>:Time to load transformer_inference op: 3.2905092239379883 seconds
[1,14]<stdout>:Loading extension module transformer_inference...
[1,14]<stdout>:Time to load transformer_inference op: 3.2853145599365234 seconds
[1,8]<stdout>:Loading extension module transformer_inference...
[1,8]<stdout>:Time to load transformer_inference op: 3.2764134407043457 seconds
[1,15]<stdout>:Loading extension module transformer_inference...
[1,15]<stdout>:Time to load transformer_inference op: 3.2675225734710693 seconds
[1,11]<stdout>:Loading extension module transformer_inference...
[1,11]<stdout>:Time to load transformer_inference op: 3.2588632106781006 seconds
[1,14]<stdout>:[2021-12-09 02:31:32,261] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,10]<stdout>:[2021-12-09 02:31:32,262] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,15]<stdout>:[2021-12-09 02:31:32,262] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,11]<stdout>:[2021-12-09 02:31:32,263] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,9]<stdout>:[2021-12-09 02:31:32,263] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,12]<stdout>:[2021-12-09 02:31:32,263] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,13]<stdout>:[2021-12-09 02:31:32,263] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,8]<stdout>:[2021-12-09 02:31:32,264] [INFO] [distributed.py:36:init_distributed] Not using the DeepSpeed or torch.distributed launchers, attempting to detect MPI environment...
[1,1]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=1, local_rank=1, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,6]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=6, local_rank=6, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,6]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,2]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=2, local_rank=2, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,2]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,5]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=5, local_rank=5, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,5]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,1]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,13]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=13, local_rank=5, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,3]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=3, local_rank=3, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,3]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,4]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=4, local_rank=4, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,4]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,7]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=7, local_rank=7, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,8]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=8, local_rank=0, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,8]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,0]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=0, local_rank=0, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,12]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=12, local_rank=4, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,12]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,7]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,14]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=14, local_rank=6, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,14]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,21]<stdout>:[2021-12-09 02:31:32,300] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=21, local_rank=5, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,21]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,0]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,9]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=9, local_rank=1, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,9]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,30]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=30, local_rank=6, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,26]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=26, local_rank=2, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,30]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,25]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=25, local_rank=1, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,25]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,26]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,31]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=31, local_rank=7, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,31]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,24]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=24, local_rank=0, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,24]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,29]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=29, local_rank=5, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,29]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,27]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=27, local_rank=3, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,28]<stdout>:[2021-12-09 02:31:32,303] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=28, local_rank=4, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,27]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,28]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,23]<stdout>:[2021-12-09 02:31:32,300] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=23, local_rank=7, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,23]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,10]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=10, local_rank=2, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,10]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,16]<stdout>:[2021-12-09 02:31:32,300] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=16, local_rank=0, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,13]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,22]<stdout>:[2021-12-09 02:31:32,300] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=22, local_rank=6, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,15]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=15, local_rank=7, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,15]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,16]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,11]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=11, local_rank=3, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,11]<stdout>:[2021-12-09 02:31:32,304] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,22]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,19]<stdout>:[2021-12-09 02:31:32,300] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=19, local_rank=3, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,19]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,18]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=18, local_rank=2, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,20]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=20, local_rank=4, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,18]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,20]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,17]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:83:mpi_discovery] Discovered MPI settings of world_rank=17, local_rank=1, world_size=32, master_addr=192.168.0.78, master_port=29500
[1,17]<stdout>:[2021-12-09 02:31:32,301] [INFO] [distributed.py:46:init_distributed] Initializing torch distributed with backend: nccl
[1,0]<stdout>:> initializing tensor model parallel with size 1
[1,0]<stdout>:> initializing pipeline model parallel with size 1
[1,0]<stdout>:> setting random seeds to 1234 ...
[1,0]<stdout>:> initializing model parallel cuda seeds on global rank 0, model parallel rank 0, and data parallel rank 0 with model parallel seed: 3952 and data parallel seed: 1234
[1,0]<stdout>:> compiling dataset index builder ...
[1,0]<stdout>:make: Entering directory '/home/amawa/moe-v2/Megatron-DeepSpeed/megatron/data'
[1,0]<stdout>:make: Nothing to be done for 'default'.
[1,0]<stdout>:make: Leaving directory '/home/amawa/moe-v2/Megatron-DeepSpeed/megatron/data'
[1,0]<stdout>:>>> done with dataset index builder. Compilation time: 0.097 seconds
[1,0]<stdout>:WARNING: constraints for invoking optimized fused softmax kernel are not met. We default back to unfused kernel invocations.
[1,0]<stdout>:> compiling and loading fused kernels ...
[1,0]<stdout>:Detected CUDA files, patching ldflags
[1,0]<stdout>:Emitting ninja build file /home/amawa/moe-v2/Megatron-DeepSpeed/megatron/fused_kernels/build/build.ninja...
[1,0]<stdout>:Building extension module scaled_upper_triang_masked_softmax_cuda...
[1,0]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,0]<stdout>:ninja: no work to do.
[1,0]<stdout>:Loading extension module scaled_upper_triang_masked_softmax_cuda...
[1,0]<stdout>:Detected CUDA files, patching ldflags
[1,0]<stdout>:Emitting ninja build file /home/amawa/moe-v2/Megatron-DeepSpeed/megatron/fused_kernels/build/build.ninja...
[1,0]<stdout>:Building extension module scaled_masked_softmax_cuda...
[1,0]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)[1,0]<stdout>:
[1,0]<stdout>:ninja: no work to do.
[1,0]<stdout>:Loading extension module scaled_masked_softmax_cuda...
[1,0]<stdout>:Detected CUDA files, patching ldflags
[1,0]<stdout>:Emitting ninja build file /home/amawa/moe-v2/Megatron-DeepSpeed/megatron/fused_kernels/build/build.ninja...
[1,0]<stdout>:Building extension module fused_mix_prec_layer_norm_cuda...
[1,0]<stdout>:Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1,0]<stdout>:ninja: no work to do.
[1,0]<stdout>:Loading extension module fused_mix_prec_layer_norm_cuda...
[1,0]<stdout>:NCCL version 2.8.4+cuda11.3
[1,0]<stdout>:>>> done with compiling and loading fused kernels. Compilation time: 17.148 seconds
[1,0]<stdout>:[2021-12-09 02:31:51,902] [INFO] [logging.py:69:log_dist] [Rank 0] initializing deepspeed groups
[1,0]<stdout>:[2021-12-09 02:31:51,903] [INFO] [logging.py:69:log_dist] [Rank 0] initializing deepspeed model parallel group with size 1
[1,0]<stdout>:[2021-12-09 02:31:52,241] [INFO] [logging.py:69:log_dist] [Rank 0] initializing deepspeed expert parallel group with size 32
[1,0]<stdout>:[2021-12-09 02:31:52,252] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [0]
[1,0]<stdout>:[2021-12-09 02:31:52,263] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [1]
[1,0]<stdout>:[2021-12-09 02:31:52,273] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [2]
[1,0]<stdout>:[2021-12-09 02:31:52,283] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [3]
[1,0]<stdout>:[2021-12-09 02:31:52,294] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [4]
[1,0]<stdout>:[2021-12-09 02:31:52,304] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [5]
[1,0]<stdout>:[2021-12-09 02:31:52,314] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [6]
[1,0]<stdout>:[2021-12-09 02:31:52,324] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [7]
[1,0]<stdout>:[2021-12-09 02:31:52,335] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [8]
[1,0]<stdout>:[2021-12-09 02:31:52,345] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [9]
[1,0]<stdout>:[2021-12-09 02:31:52,355] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [10]
[1,0]<stdout>:[2021-12-09 02:31:52,366] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [11]
[1,0]<stdout>:[2021-12-09 02:31:52,376] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [12]
[1,0]<stdout>:[2021-12-09 02:31:52,386] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [13]
[1,0]<stdout>:[2021-12-09 02:31:52,396] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [14]
[1,0]<stdout>:[2021-12-09 02:31:52,407] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [15]
[1,0]<stdout>:[2021-12-09 02:31:52,417] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [16]
[1,0]<stdout>:[2021-12-09 02:31:52,427] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [17]
[1,0]<stdout>:[2021-12-09 02:31:52,437] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [18]
[1,0]<stdout>:[2021-12-09 02:31:52,448] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [19]
[1,0]<stdout>:[2021-12-09 02:31:52,458] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [20]
[1,0]<stdout>:[2021-12-09 02:31:52,468] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [21]
[1,0]<stdout>:[2021-12-09 02:31:52,479] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [22]
[1,0]<stdout>:[2021-12-09 02:31:52,489] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [23]
[1,0]<stdout>:[2021-12-09 02:31:52,499] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [24]
[1,0]<stdout>:[2021-12-09 02:31:52,519] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [25]
[1,0]<stdout>:[2021-12-09 02:31:52,520] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [26]
[1,0]<stdout>:[2021-12-09 02:31:52,540] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [27]
[1,0]<stdout>:[2021-12-09 02:31:52,550] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [28]
[1,0]<stdout>:[2021-12-09 02:31:52,550] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [29]
[1,0]<stdout>:[2021-12-09 02:31:52,571] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [30]
[1,0]<stdout>:[2021-12-09 02:31:52,581] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert data parallel process group with ranks: [31]
[1,0]<stdout>:[2021-12-09 02:31:52,592] [INFO] [logging.py:69:log_dist] [Rank 0] creating expert parallel process group with ranks: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
[1,0]<stdout>:building GPT model ...
[1,0]<stdout>:[2021-12-09 02:31:52,676] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:52,733] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:52,793] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:52,849] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:52,908] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:52,968] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,027] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,088] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,152] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,212] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,271] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,330] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,391] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,453] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,514] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,578] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,639] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,699] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,0]<stdout>:[2021-12-09 02:31:53,757] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,4]<stdout>:[2021-12-09 02:31:53,795] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,4]<stdout>:moe = True, moe_experts= 128
[1,4]<stdout>:************ 1 ***********
[1,0]<stdout>:[2021-12-09 02:31:53,814] [INFO] [logging.py:69:log_dist] [Rank 0] num_experts: 128 | num_local_experts: 4 | expert_parallel_size: 32
[1,7]<stdout>:[2021-12-09 02:31:53,824] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,6]<stdout>:[2021-12-09 02:31:53,830] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,3]<stdout>:[2021-12-09 02:31:53,830] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,2]<stdout>:[2021-12-09 02:31:53,832] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,1]<stdout>:[2021-12-09 02:31:53,836] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,7]<stdout>:moe = True, moe_experts= 128
[1,7]<stdout>:************ 1 ***********
[1,5]<stdout>:[2021-12-09 02:31:53,837] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,0]<stdout>: > number of parameters on (tensor, pipeline) model parallel rank (0, 0): 16330219520
[1,0]<stdout>:[2021-12-09 02:31:53,839] [INFO] [logging.py:69:log_dist] [Rank 0] DeepSpeed info: version=0.5.7+e806499e, git-hash=e806499e, git-branch=merge-moe-specialized
[1,0]<stdout>:[2021-12-09 02:31:53,840] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,6]<stdout>:moe = True, moe_experts= 128
[1,6]<stdout>:************ 1 ***********
[1,3]<stdout>:moe = True, moe_experts= 128
[1,3]<stdout>:************ 1 ***********
[1,2]<stdout>:moe = True, moe_experts= 128
[1,2]<stdout>:************ 1 ***********
[1,1]<stdout>:moe = True, moe_experts= 128
[1,1]<stdout>:************ 1 ***********
[1,5]<stdout>:moe = True, moe_experts= 128
[1,5]<stdout>:************ 1 ***********
[1,0]<stdout>:moe = True, moe_experts= 128
[1,0]<stdout>:************ 1 ***********
[1,4]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,4]<stdout>:Loading extension module transformer_inference...
[1,4]<stdout>:Time to load transformer_inference op: 0.04401040077209473 seconds
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,7]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,7]<stdout>:Loading extension module transformer_inference...
[1,7]<stdout>:Time to load transformer_inference op: 0.04168272018432617 seconds
[1,7]<stdout>:DeepSpeed Transformer Inference config is  [1,7]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,6]<stdout>:Loading extension module transformer_inference...
[1,6]<stdout>:Time to load transformer_inference op: 0.03939104080200195 seconds
[1,6]<stdout>:DeepSpeed Transformer Inference config is  [1,6]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,2]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,2]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,2]<stdout>:Loading extension module transformer_inference...
[1,0]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,0]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:Time to load transformer_inference op: 0.03943657875061035 seconds
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:Time to load transformer_inference op: 0.03503274917602539 seconds
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,3]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,3]<stdout>:Loading extension module transformer_inference...
[1,3]<stdout>:Time to load transformer_inference op: 0.040500640869140625 seconds
[1,3]<stdout>:DeepSpeed Transformer Inference config is [1,3]<stdout>: [1,3]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,1]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,1]<stdout>:Loading extension module transformer_inference...
[1,1]<stdout>:Time to load transformer_inference op: 0.038793087005615234 seconds
[1,1]<stdout>:DeepSpeed Transformer Inference config is  [1,1]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,5]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,5]<stdout>:Loading extension module transformer_inference...
[1,5]<stdout>:Time to load transformer_inference op: 0.0388798713684082 seconds
[1,5]<stdout>:DeepSpeed Transformer Inference config is  [1,5]<stdout>:{'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:[2021-12-09 02:31:53,932] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,24]<stdout>:moe = True, moe_experts= 128
[1,24]<stdout>:************ 1 ***********
[1,30]<stdout>:[2021-12-09 02:31:53,945] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,27]<stdout>:[2021-12-09 02:31:53,956] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,29]<stdout>:[2021-12-09 02:31:53,957] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,30]<stdout>:moe = True, moe_experts= 128
[1,30]<stdout>:************ 1 ***********
[1,25]<stdout>:[2021-12-09 02:31:53,958] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,26]<stdout>:[2021-12-09 02:31:53,961] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,28]<stdout>:[2021-12-09 02:31:53,962] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,31]<stdout>:[2021-12-09 02:31:53,962] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,27]<stdout>:moe = True, moe_experts= 128
[1,27]<stdout>:************ 1 ***********
[1,29]<stdout>:moe = True, moe_experts= 128
[1,29]<stdout>:************ 1 ***********
[1,25]<stdout>:moe = True, moe_experts= 128
[1,25]<stdout>:************ 1 ***********
[1,26]<stdout>:moe = True, moe_experts= 128
[1,26]<stdout>:************ 1 ***********
[1,31]<stdout>:moe = True, moe_experts= 128
[1,31]<stdout>:************ 1 ***********
[1,8]<stdout>:[2021-12-09 02:31:53,979] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,28]<stdout>:moe = True, moe_experts= 128
[1,28]<stdout>:************ 1 ***********
[1,10]<stdout>:[2021-12-09 02:31:53,986] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,9]<stdout>:[2021-12-09 02:31:53,987] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,12]<stdout>:[2021-12-09 02:31:53,987] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,8]<stdout>:moe = True, moe_experts= 128
[1,8]<stdout>:************ 1 ***********
[1,4]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,4]<stdout>:Loading extension module transformer_inference...
[1,4]<stdout>:Time to load transformer_inference op: 0.06450366973876953 seconds
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,10]<stdout>:moe = True, moe_experts= 128
[1,10]<stdout>:************ 1 ***********
[1,15]<stdout>:[2021-12-09 02:31:53,998] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,11]<stdout>:[2021-12-09 02:31:53,998] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,14]<stdout>:[2021-12-09 02:31:53,998] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,13]<stdout>:[2021-12-09 02:31:53,998] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,9]<stdout>:moe = True, moe_experts= 128
[1,9]<stdout>:************ 1 ***********
[1,12]<stdout>:moe = True, moe_experts= 128
[1,12]<stdout>:************ 1 ***********
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:moe = True, moe_experts= 128
[1,15]<stdout>:************ 1 ***********
[1,14]<stdout>:moe = True, moe_experts= 128
[1,14]<stdout>:************ 1 ***********
[1,11]<stdout>:moe = True, moe_experts= 128
[1,11]<stdout>:************ 1 ***********
[1,13]<stdout>:moe = True, moe_experts= 128
[1,13]<stdout>:************ 1 ***********
[1,24]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,24]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,24]<stdout>:Loading extension module transformer_inference...
[1,24]<stdout>:Time to load transformer_inference op: 0.04204535484313965 seconds
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,0]<stdout>:Loading extension module transformer_inference...
[1,30]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:Time to load transformer_inference op: 0.03325605392456055 seconds
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,30]<stdout>:Loading extension module transformer_inference...
[1,0]<stdout>:local_ep_size = 4
[1,30]<stdout>:Time to load transformer_inference op: 0.034685373306274414 seconds
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,2]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,2]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,2]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:Time to load transformer_inference op: 0.0387723445892334 seconds
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,3]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,2]<stdout>:local_ep_size = 4
[1,1]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,1]<stdout>:Loading extension module transformer_inference...
[1,3]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,3]<stdout>:Loading extension module transformer_inference...
[1,7]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,1]<stdout>:Time to load transformer_inference op: 0.04088449478149414 seconds
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,5]<stdout>:Loading extension module transformer_inference...
[1,3]<stdout>:Time to load transformer_inference op: 0.040194034576416016 seconds
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,6]<stdout>:Loading extension module transformer_inference...
[1,5]<stdout>:Time to load transformer_inference op: 0.04122138023376465 seconds
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:Time to load transformer_inference op: 0.04053330421447754 seconds
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,7]<stdout>:Loading extension module transformer_inference...
[1,1]<stdout>:local_ep_size = 4
[1,3]<stdout>:local_ep_size = 4
[1,7]<stdout>:Time to load transformer_inference op: 0.0417323112487793 seconds
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4
[1,7]<stdout>:local_ep_size = 4
[1,25]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,25]<stdout>:Loading extension module transformer_inference...
[1,27]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,25]<stdout>:Time to load transformer_inference op: 0.03375720977783203 seconds
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,27]<stdout>:Loading extension module transformer_inference...
[1,27]<stdout>:Time to load transformer_inference op: 0.03541159629821777 seconds
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,29]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,29]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,29]<stdout>:Time to load transformer_inference op: 0.03631258010864258 seconds
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,1]<stdout>:
[1,26]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:DeepSpeed Transformer Inference config is  [1,5]<stdout>:{'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,26]<stdout>:Loading extension module transformer_inference...
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:Time to load transformer_inference op: 0.03500771522521973 seconds
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,31]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,31]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,31]<stdout>:Time to load transformer_inference op: 0.035375118255615234 seconds
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:local_ep_size = 4
[1,5]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,28]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,28]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,28]<stdout>:Loading extension module transformer_inference...
[1,28]<stdout>:Time to load transformer_inference op: 0.035993099212646484 seconds
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,8]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,8]<stdout>:Loading extension module transformer_inference...
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:Time to load transformer_inference op: 0.03907632827758789 seconds
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,10]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,10]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:Time to load transformer_inference op: 0.03554654121398926 seconds
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,12]<stdout>:Loading extension module transformer_inference...
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,12]<stdout>:Time to load transformer_inference op: 0.036062002182006836 seconds
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,9]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,9]<stdout>:Loading extension module transformer_inference...
[1,9]<stdout>:Time to load transformer_inference op: 0.03830742835998535 seconds
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:
[1,1]<stdout>:DeepSpeed Transformer Inference config is  [1,1]<stdout>:{'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,7]<stdout>:
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,14]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,14]<stdout>:Loading extension module transformer_inference...
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,14]<stdout>:Time to load transformer_inference op: 0.036479949951171875 seconds
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,15]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,15]<stdout>:Loading extension module transformer_inference...
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,15]<stdout>:Time to load transformer_inference op: 0.037540435791015625 seconds
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,11]<stdout>:Loading extension module transformer_inference...
[1,2]<stdout>:local_ep_size = 4
[1,11]<stdout>:Time to load transformer_inference op: 0.037661075592041016 seconds
[1,13]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,13]<stdout>:Loading extension module transformer_inference...
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:Time to load transformer_inference op: 0.037489891052246094 seconds
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,1]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,0]<stdout>:
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:local_ep_size = 4
[1,24]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,24]<stdout>:Loading extension module transformer_inference...
[1,24]<stdout>:Time to load transformer_inference op: 0.03724408149719238 seconds
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:
[1,24]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,1]<stdout>:
[1,30]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,30]<stdout>:Loading extension module transformer_inference...
[1,30]<stdout>:Time to load transformer_inference op: 0.03450441360473633 seconds
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,1]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,25]<stdout>:Loading extension module transformer_inference...
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,25]<stdout>:Time to load transformer_inference op: 0.03472399711608887 seconds
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,27]<stdout>:Loading extension module transformer_inference...
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:Time to load transformer_inference op: 0.03555583953857422 seconds
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:local_ep_size = 4
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:local_ep_size = 4
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed Transformer Inference config is  [1,7]<stdout>:{'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,26]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,26]<stdout>:Loading extension module transformer_inference...
[1,4]<stdout>:local_ep_size = 4
[1,26]<stdout>:Time to load transformer_inference op: 0.03387761116027832 seconds
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:local_ep_size = 4
[1,26]<stdout>:local_ep_size = 4
[1,29]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}[1,3]<stdout>:
[1,3]<stdout>:local_ep_size = 4
[1,29]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,29]<stdout>:Loading extension module transformer_inference...
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:Time to load transformer_inference op: 0.035752058029174805 seconds
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4
[1,31]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,18]<stdout>:[2021-12-09 02:31:54,120] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,1]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,31]<stdout>:Loading extension module transformer_inference...
[1,7]<stdout>:local_ep_size = 4
[1,31]<stdout>:Time to load transformer_inference op: 0.03546643257141113 seconds
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,20]<stdout>:[2021-12-09 02:31:54,128] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,4]<stdout>:
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,28]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,27]<stdout>:local_ep_size = 4
[1,28]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,28]<stdout>:Loading extension module transformer_inference...
[1,5]<stdout>:DeepSpeed Transformer Inference config is  [1,5]<stdout>:{'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:Time to load transformer_inference op: 0.03524899482727051 seconds
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:local_ep_size = 4
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,7]<stdout>:
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe = True, moe_experts= 128
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,18]<stdout>:************ 1 ***********
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe = True, moe_experts= 128
[1,20]<stdout>:************ 1 ***********
[1,8]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,10]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,31]<stdout>:local_ep_size = 4
[1,8]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,8]<stdout>:Loading extension module transformer_inference...
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,10]<stdout>:Loading extension module transformer_inference...
[1,8]<stdout>:Time to load transformer_inference op: 0.03679823875427246 seconds
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:Time to load transformer_inference op: 0.03586983680725098 seconds
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:[2021-12-09 02:31:54,142] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,8]<stdout>:local_ep_size = 4
[1,10]<stdout>:local_ep_size = 4
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:[2021-12-09 02:31:54,144] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,27]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:
[1,12]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:DeepSpeed Transformer Inference config is  [1,6]<stdout>:{'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,12]<stdout>:Loading extension module transformer_inference...
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:local_ep_size = 4
[1,12]<stdout>:Time to load transformer_inference op: 0.03827857971191406 seconds
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,9]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,9]<stdout>:Loading extension module transformer_inference...
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:Time to load transformer_inference op: 0.03767251968383789 seconds
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:local_ep_size = 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,22]<stdout>:moe = True, moe_experts= 128
[1,22]<stdout>:************ 1 ***********
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,2]<stdout>:local_ep_size = 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,19]<stdout>:moe = True, moe_experts= 128
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:************ 1 ***********
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:[2021-12-09 02:31:54,161] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,14]<stdout>:Loading extension module transformer_inference...
[1,10]<stdout>:local_ep_size = 4
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:Time to load transformer_inference op: 0.036307334899902344 seconds
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:[2021-12-09 02:31:54,162] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,14]<stdout>:local_ep_size = 4
[1,15]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,15]<stdout>:Loading extension module transformer_inference...
[1,13]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,15]<stdout>:Time to load transformer_inference op: 0.03719472885131836 seconds
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,23]<stdout>:[2021-12-09 02:31:54,163] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,13]<stdout>:Loading extension module transformer_inference...
[1,21]<stdout>:[2021-12-09 02:31:54,163] [INFO] [engine.py:151:_init_quantization_setting] quantize_bits = 8 mlp_extra_grouping = False, quantize_groups = 1
[1,15]<stdout>:local_ep_size = 4
[1,13]<stdout>:Time to load transformer_inference op: 0.03655362129211426 seconds
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,11]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,11]<stdout>:Loading extension module transformer_inference...
[1,25]<stdout>:local_ep_size = 4
[1,11]<stdout>:Time to load transformer_inference op: 0.03726458549499512 seconds
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,6]<stdout>:DeepSpeed Transformer Inference config is  [1,6]<stdout>:{'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  [1,1]<stdout>:{'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:local_ep_size = 4
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,7]<stdout>:
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:local_ep_size = 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe = True, moe_experts= 128
[1,17]<stdout>:************ 1 ***********
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:moe = True, moe_experts= 128
[1,16]<stdout>:************ 1 ***********
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:moe = True, moe_experts= 128
[1,3]<stdout>:local_ep_size = 4
[1,23]<stdout>:************ 1 ***********
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,29]<stdout>:local_ep_size = 4
[1,6]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4[1,8]<stdout>:
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:moe = True, moe_experts= 128
[1,21]<stdout>:************ 1 ***********
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:
[1,0]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:local_ep_size = 4
[1,27]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  [1,6]<stdout>:{'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,7]<stdout>:
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:local_ep_size = 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,26]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:local_ep_size = 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4
[1,0]<stdout>:local_ep_size = 4
[1,20]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,1]<stdout>:
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:local_ep_size = 4
[1,12]<stdout>:local_ep_size = 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,7]<stdout>:
[1,20]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,20]<stdout>:Loading extension module transformer_inference...
[1,18]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,18]<stdout>:Loading extension module transformer_inference...
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,20]<stdout>:Time to load transformer_inference op: 0.035566091537475586 seconds
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:Time to load transformer_inference op: 0.04188990592956543 seconds
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,4]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,6]<stdout>:DeepSpeed Transformer Inference config is  [1,5]<stdout>:
[1,6]<stdout>:{'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4[1,28]<stdout>:
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4
[1,0]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4
[1,24]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,1]<stdout>:
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  [1,7]<stdout>:{'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,9]<stdout>:local_ep_size = 4
[1,4]<stdout>:local_ep_size = 4
[1,19]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,19]<stdout>:Loading extension module transformer_inference...
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,19]<stdout>:Time to load transformer_inference op: 0.03604531288146973 seconds
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:{'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:local_ep_size = 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,22]<stdout>:Loading extension module transformer_inference...
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,1]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4
[1,22]<stdout>:Time to load transformer_inference op: 0.03856468200683594 seconds
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,6]<stdout>:
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,2]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,3]<stdout>:
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:local_ep_size = 4
[1,24]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,30]<stdout>:local_ep_size = 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed Transformer Inference config is  [1,7]<stdout>:{'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,16]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,16]<stdout>:Loading extension module transformer_inference...
[1,26]<stdout>:local_ep_size = 4
[1,16]<stdout>:Time to load transformer_inference op: 0.03659844398498535 seconds
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,17]<stdout>:Loading extension module transformer_inference...
[1,29]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:Time to load transformer_inference op: 0.037190914154052734 seconds
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,0]<stdout>:DeepSpeed Transformer Inference config is [1,0]<stdout>: {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,23]<stdout>:Loading extension module transformer_inference...
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:Time to load transformer_inference op: 0.03780078887939453 seconds
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,21]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,21]<stdout>:Loading extension module transformer_inference...
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:Time to load transformer_inference op: 0.03860640525817871 seconds
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 0, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:local_ep_size = 4
[1,13]<stdout>:local_ep_size = 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,5]<stdout>:
[1,25]<stdout>:local_ep_size = 4
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed Transformer Inference config is  [1,3]<stdout>:{'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:local_ep_size = 4
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:{'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,6]<stdout>:
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:local_ep_size = 4
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,14]<stdout>:local_ep_size = 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,15]<stdout>:local_ep_size = 4
[1,5]<stdout>:
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,4]<stdout>:local_ep_size = 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  [1,3]<stdout>:{'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:local_ep_size = 4
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:local_ep_size = 4
[1,30]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  [1,7]<stdout>:{'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,20]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,20]<stdout>:Loading extension module transformer_inference...
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:Time to load transformer_inference op: 0.03339409828186035 seconds
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,18]<stdout>:Loading extension module transformer_inference...
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:Time to load transformer_inference op: 0.03620600700378418 seconds
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:local_ep_size = 4
[1,14]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:local_ep_size = 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:local_ep_size = 4
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:local_ep_size = 4
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed Transformer Inference config is  [1,5]<stdout>:{'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,0]<stdout>:local_ep_size = 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:local_ep_size = 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:local_ep_size = 4
[1,24]<stdout>:local_ep_size = 4
[1,30]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:local_ep_size = 4
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:local_ep_size = 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,4]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,6]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,19]<stdout>:Loading extension module transformer_inference...
[1,18]<stdout>:local_ep_size = 4
[1,19]<stdout>:Time to load transformer_inference op: 0.0378725528717041 seconds
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,8]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,22]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,22]<stdout>:Loading extension module transformer_inference...
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:Time to load transformer_inference op: 0.03640389442443848 seconds
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:local_ep_size = 4
[1,4]<stdout>:DeepSpeed Transformer Inference config is  [1,4]<stdout>:{'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:local_ep_size = 4
[1,9]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:local_ep_size = 4
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,0]<stdout>:DeepSpeed Transformer Inference config is  [1,0]<stdout>:{'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:moe, num_experts = True, 4, MoE(
[1,4]<stdout>:  (deepspeed_moe): MOELayer(
[1,4]<stdout>:    (gate): TopKGate(
[1,4]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,4]<stdout>:    )
[1,4]<stdout>:    (experts): Experts(
[1,4]<stdout>:      (deepspeed_experts): ModuleList(
[1,4]<stdout>:        (0): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (1): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (2): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:        (3): ParallelMLP(
[1,4]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,4]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,4]<stdout>:        )
[1,4]<stdout>:      )
[1,4]<stdout>:    )
[1,4]<stdout>:  )
[1,4]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,4]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:{'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,4]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,31]<stdout>:local_ep_size = 4
[1,1]<stdout>:local_ep_size = 4
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,16]<stdout>:Loading extension module transformer_inference...
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,16]<stdout>:Time to load transformer_inference op: 0.03387188911437988 seconds
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,2]<stdout>:DeepSpeed Transformer Inference config is  [1,2]<stdout>:{'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed Transformer Inference config is  [1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:{'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,17]<stdout>:Loading extension module transformer_inference...
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:Time to load transformer_inference op: 0.03746628761291504 seconds
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:local_ep_size = 4
[1,13]<stdout>:local_ep_size = 4
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:local_ep_size = 4
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:local_ep_size = 4
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,4]<stdout>:[2021-12-09 02:31:54,336] [INFO] [engine.py:107:__init__] Place model to device: 4
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,23]<stdout>:Loading extension module transformer_inference...
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:Time to load transformer_inference op: 0.036260366439819336 seconds
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:local_ep_size = 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:Using /home/amawa/.cache/torch_extensions as PyTorch extensions root...
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:No modifications detected for re-loaded extension module transformer_inference, skipping build step...
[1,21]<stdout>:Loading extension module transformer_inference...
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:Time to load transformer_inference op: 0.03828692436218262 seconds
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 1, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,6]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,1]<stdout>:local_ep_size = 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,2]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,19]<stdout>:local_ep_size = 4
[1,5]<stdout>:
[1,2]<stdout>:moe, num_experts = True, 4, MoE(
[1,2]<stdout>:  (deepspeed_moe): MOELayer(
[1,2]<stdout>:    (gate): TopKGate(
[1,2]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,2]<stdout>:    )
[1,2]<stdout>:    (experts): Experts(
[1,2]<stdout>:      (deepspeed_experts): ModuleList(
[1,2]<stdout>:        (0): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (1): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (2): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:        (3): ParallelMLP(
[1,2]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,2]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,2]<stdout>:        )
[1,2]<stdout>:      )
[1,2]<stdout>:    )
[1,2]<stdout>:  )
[1,2]<stdout>:), 4
[1,2]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:local_ep_size = 4
[1,9]<stdout>:local_ep_size = 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,6]<stdout>:
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4
[1,13]<stdout>:local_ep_size = 4
[1,2]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,2]<stdout>:{'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,4]<stdout>:> DeepSpeed Inference initialized
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:local_ep_size = 4
[1,1]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:local_ep_size = 4
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,0]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}[1,0]<stdout>:
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 2, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:moe, num_experts = True, 4, MoE(
[1,6]<stdout>:  (deepspeed_moe): MOELayer(
[1,6]<stdout>:    (gate): TopKGate(
[1,6]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,6]<stdout>:    )
[1,6]<stdout>:    (experts): Experts(
[1,6]<stdout>:      (deepspeed_experts): ModuleList(
[1,6]<stdout>:        (0): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (1): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (2): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:        (3): ParallelMLP(
[1,6]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,6]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,6]<stdout>:        )
[1,6]<stdout>:      )
[1,6]<stdout>:    )
[1,6]<stdout>:  )
[1,6]<stdout>:), 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:moe, num_experts = True, 4, MoE(
[1,0]<stdout>:  (deepspeed_moe): MOELayer(
[1,0]<stdout>:    (gate): TopKGate(
[1,0]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,0]<stdout>:    )
[1,0]<stdout>:    (experts): Experts(
[1,0]<stdout>:      (deepspeed_experts): ModuleList(
[1,0]<stdout>:        (0): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (1): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (2): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:        (3): ParallelMLP(
[1,0]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,0]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,0]<stdout>:        )
[1,0]<stdout>:      )
[1,0]<stdout>:    )
[1,0]<stdout>:  )
[1,0]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  [1,7]<stdout>:{'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,30]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,6]<stdout>:local_ep_size = 4
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,1]<stdout>:{'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,0]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,0]<stdout>:{'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 3, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4
[1,26]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4
[1,2]<stdout>:[2021-12-09 02:31:54,362] [INFO] [engine.py:107:__init__] Place model to device: 2
[1,4]<stdout>:NCCL version 2.8.4+cuda11.3
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,7]<stdout>:local_ep_size = 4
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:local_ep_size = 4
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:local_ep_size = 4
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:DeepSpeed Transformer Inference config is  [1,3]<stdout>:{'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,5]<stdout>:moe, num_experts = True, 4, MoE(
[1,5]<stdout>:  (deepspeed_moe): MOELayer(
[1,5]<stdout>:    (gate): TopKGate(
[1,5]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,5]<stdout>:    )
[1,5]<stdout>:    (experts): Experts(
[1,5]<stdout>:      (deepspeed_experts): ModuleList(
[1,5]<stdout>:        (0): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (1): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (2): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:        (3): ParallelMLP(
[1,5]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,5]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,5]<stdout>:        )
[1,5]<stdout>:      )
[1,5]<stdout>:    )
[1,5]<stdout>:  )
[1,5]<stdout>:), 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,6]<stdout>:[2021-12-09 02:31:54,368] [INFO] [engine.py:107:__init__] Place model to device: 6
[1,1]<stdout>:DeepSpeed Transformer Inference config is  [1,1]<stdout>:{'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,3]<stdout>:moe, num_experts = True, 4, MoE(
[1,3]<stdout>:  (deepspeed_moe): MOELayer(
[1,3]<stdout>:    (gate): TopKGate(
[1,3]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,3]<stdout>:    )
[1,3]<stdout>:    (experts): Experts(
[1,3]<stdout>:      (deepspeed_experts): ModuleList(
[1,3]<stdout>:        (0): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (1): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (2): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:        (3): ParallelMLP(
[1,3]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,3]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,3]<stdout>:        )
[1,3]<stdout>:      )
[1,3]<stdout>:    )
[1,3]<stdout>:  )
[1,3]<stdout>:), 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,12]<stdout>:local_ep_size = 4
[1,5]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,5]<stdout>:{'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,0]<stdout>:[2021-12-09 02:31:54,370] [INFO] [engine.py:107:__init__] Place model to device: 0
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:local_ep_size = 4
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:moe, num_experts = True, 4, MoE(
[1,1]<stdout>:  (deepspeed_moe): MOELayer(
[1,1]<stdout>:    (gate): TopKGate(
[1,1]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,1]<stdout>:    )
[1,1]<stdout>:    (experts): Experts(
[1,1]<stdout>:      (deepspeed_experts): ModuleList(
[1,1]<stdout>:        (0): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (1): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (2): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:        (3): ParallelMLP(
[1,1]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,1]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,1]<stdout>:        )
[1,1]<stdout>:      )
[1,1]<stdout>:    )
[1,1]<stdout>:  )
[1,1]<stdout>:), 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 4, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,7]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:local_ep_size = 4
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,3]<stdout>:{'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,3]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}[1,1]<stdout>:
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,1]<stdout>:local_ep_size = 4
[1,7]<stdout>:moe, num_experts = True, 4, MoE(
[1,7]<stdout>:  (deepspeed_moe): MOELayer(
[1,7]<stdout>:    (gate): TopKGate(
[1,7]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,7]<stdout>:    )
[1,7]<stdout>:    (experts): Experts(
[1,7]<stdout>:      (deepspeed_experts): ModuleList(
[1,7]<stdout>:        (0): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (1): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (2): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:        (3): ParallelMLP(
[1,7]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,7]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,7]<stdout>:        )
[1,7]<stdout>:      )
[1,7]<stdout>:    )
[1,7]<stdout>:  )
[1,7]<stdout>:), 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4
[1,7]<stdout>:DeepSpeed MoE Transformer Inference config is  [1,7]<stdout>:{'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 5, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,5]<stdout>:[2021-12-09 02:31:54,380] [INFO] [engine.py:107:__init__] Place model to device: 5
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:local_ep_size = 4
[1,3]<stdout>:[2021-12-09 02:31:54,383] [INFO] [engine.py:107:__init__] Place model to device: 3
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:local_ep_size = 4
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:[2021-12-09 02:31:54,385] [INFO] [engine.py:107:__init__] Place model to device: 1
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,2]<stdout>:> DeepSpeed Inference initialized
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:local_ep_size = 4
[1,7]<stdout>:[2021-12-09 02:31:54,389] [INFO] [engine.py:107:__init__] Place model to device: 7
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 6, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,2]<stdout>:NCCL version 2.8.4+cuda11.3
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,6]<stdout>:> DeepSpeed Inference initialized
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4
[1,6]<stdout>:NCCL version 2.8.4+cuda11.3
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,0]<stdout>:> DeepSpeed Inference initialized
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:local_ep_size = 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 7, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:local_ep_size = 4
[1,9]<stdout>:local_ep_size = 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:local_ep_size = 4
[1,12]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,10]<stdout>:local_ep_size = 4
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,5]<stdout>:> DeepSpeed Inference initialized
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,3]<stdout>:> DeepSpeed Inference initialized
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,5]<stdout>:NCCL version 2.8.4+cuda11.3
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 8, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,3]<stdout>:NCCL version 2.8.4+cuda11.3
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,1]<stdout>:> DeepSpeed Inference initialized
[1,23]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,1]<stdout>:NCCL version 2.8.4+cuda11.3
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 9, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,7]<stdout>:> DeepSpeed Inference initialized
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,7]<stdout>:NCCL version 2.8.4+cuda11.3
[1,16]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4
[1,31]<stdout>:local_ep_size = 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:local_ep_size = 4
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,30]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,24]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 10, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,24]<stdout>:moe, num_experts = True, 4, MoE(
[1,24]<stdout>:  (deepspeed_moe): MOELayer(
[1,24]<stdout>:    (gate): TopKGate(
[1,24]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,24]<stdout>:    )
[1,24]<stdout>:    (experts): Experts(
[1,24]<stdout>:      (deepspeed_experts): ModuleList(
[1,24]<stdout>:        (0): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (1): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (2): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:        (3): ParallelMLP(
[1,24]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,24]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,24]<stdout>:        )
[1,24]<stdout>:      )
[1,24]<stdout>:    )
[1,24]<stdout>:  )
[1,24]<stdout>:), 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:local_ep_size = 4
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,24]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,24]<stdout>:local_ep_size = 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:local_ep_size = 4
[1,30]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 11, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:moe, num_experts = True, 4, MoE(
[1,30]<stdout>:  (deepspeed_moe): MOELayer(
[1,30]<stdout>:    (gate): TopKGate(
[1,30]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,30]<stdout>:    )
[1,30]<stdout>:    (experts): Experts(
[1,30]<stdout>:      (deepspeed_experts): ModuleList(
[1,30]<stdout>:        (0): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (1): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (2): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:        (3): ParallelMLP(
[1,30]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,30]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,30]<stdout>:        )
[1,30]<stdout>:      )
[1,30]<stdout>:    )
[1,30]<stdout>:  )
[1,30]<stdout>:), 4
[1,30]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,30]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:local_ep_size = 4
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:local_ep_size = 4
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,27]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,24]<stdout>:[2021-12-09 02:31:54,440] [INFO] [engine.py:107:__init__] Place model to device: 0
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,25]<stdout>:moe, num_experts = True, 4, MoE(
[1,25]<stdout>:  (deepspeed_moe): MOELayer(
[1,25]<stdout>:    (gate): TopKGate(
[1,25]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,25]<stdout>:    )
[1,25]<stdout>:    (experts): Experts(
[1,25]<stdout>:      (deepspeed_experts): ModuleList(
[1,25]<stdout>:        (0): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (1): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (2): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:        (3): ParallelMLP(
[1,25]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,25]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,25]<stdout>:        )
[1,25]<stdout>:      )
[1,25]<stdout>:    )
[1,25]<stdout>:  )
[1,25]<stdout>:), 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 12, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,25]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,25]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:local_ep_size = 4
[1,14]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4
[1,27]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,30]<stdout>:[2021-12-09 02:31:54,448] [INFO] [engine.py:107:__init__] Place model to device: 6
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 13, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,8]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:moe, num_experts = True, 4, MoE(
[1,27]<stdout>:  (deepspeed_moe): MOELayer(
[1,27]<stdout>:    (gate): TopKGate(
[1,27]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,27]<stdout>:    )
[1,27]<stdout>:    (experts): Experts(
[1,27]<stdout>:      (deepspeed_experts): ModuleList(
[1,27]<stdout>:        (0): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (1): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (2): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:        (3): ParallelMLP(
[1,27]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,27]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,27]<stdout>:        )
[1,27]<stdout>:      )
[1,27]<stdout>:    )
[1,27]<stdout>:  )
[1,27]<stdout>:), 4
[1,27]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,29]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,28]<stdout>:local_ep_size = 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:local_ep_size = 4
[1,27]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:[2021-12-09 02:31:54,456] [INFO] [engine.py:107:__init__] Place model to device: 1
[1,24]<stdout>:> DeepSpeed Inference initialized
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:local_ep_size = 4
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:local_ep_size = 4
[1,29]<stdout>:moe, num_experts = True, 4, MoE(
[1,29]<stdout>:  (deepspeed_moe): MOELayer(
[1,29]<stdout>:    (gate): TopKGate(
[1,29]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,29]<stdout>:    )
[1,29]<stdout>:    (experts): Experts(
[1,29]<stdout>:      (deepspeed_experts): ModuleList(
[1,29]<stdout>:        (0): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (1): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (2): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:        (3): ParallelMLP(
[1,29]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,29]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,29]<stdout>:        )
[1,29]<stdout>:      )
[1,29]<stdout>:    )
[1,29]<stdout>:  )
[1,29]<stdout>:), 4
[1,29]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,24]<stdout>:NCCL version 2.8.4+cuda11.3
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,26]<stdout>:moe, num_experts = True, 4, MoE(
[1,26]<stdout>:  (deepspeed_moe): MOELayer(
[1,26]<stdout>:    (gate): TopKGate(
[1,26]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,26]<stdout>:    )
[1,26]<stdout>:    (experts): Experts(
[1,26]<stdout>:      (deepspeed_experts): ModuleList(
[1,26]<stdout>:        (0): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (1): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (2): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:        (3): ParallelMLP(
[1,26]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,26]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,26]<stdout>:        )
[1,26]<stdout>:      )
[1,26]<stdout>:    )
[1,26]<stdout>:  )
[1,26]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,26]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,11]<stdout>:local_ep_size = 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,31]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 14, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:local_ep_size = 4
[1,29]<stdout>:local_ep_size = 4
[1,10]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:local_ep_size = 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:local_ep_size = 4
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,31]<stdout>:moe, num_experts = True, 4, MoE(
[1,31]<stdout>:  (deepspeed_moe): MOELayer(
[1,31]<stdout>:    (gate): TopKGate(
[1,31]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,31]<stdout>:    )
[1,31]<stdout>:    (experts): Experts(
[1,31]<stdout>:      (deepspeed_experts): ModuleList(
[1,31]<stdout>:        (0): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (1): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (2): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:        (3): ParallelMLP(
[1,31]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,31]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,31]<stdout>:        )
[1,31]<stdout>:      )
[1,31]<stdout>:    )
[1,31]<stdout>:  )
[1,31]<stdout>:), 4
[1,30]<stdout>:> DeepSpeed Inference initialized
[1,31]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4
[1,10]<stdout>:moe, num_experts = True, 4, MoE(
[1,10]<stdout>:  (deepspeed_moe): MOELayer(
[1,10]<stdout>:    (gate): TopKGate(
[1,10]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,10]<stdout>:    )
[1,10]<stdout>:    (experts): Experts(
[1,10]<stdout>:      (deepspeed_experts): ModuleList(
[1,10]<stdout>:        (0): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (1): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (2): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:        (3): ParallelMLP(
[1,10]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,10]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,10]<stdout>:        )
[1,10]<stdout>:      )
[1,10]<stdout>:    )
[1,10]<stdout>:  )
[1,10]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,10]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,27]<stdout>:[2021-12-09 02:31:54,465] [INFO] [engine.py:107:__init__] Place model to device: 3
[1,30]<stdout>:NCCL version 2.8.4+cuda11.3
[1,8]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,28]<stdout>:moe, num_experts = True, 4, MoE(
[1,28]<stdout>:  (deepspeed_moe): MOELayer(
[1,28]<stdout>:    (gate): TopKGate(
[1,28]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,28]<stdout>:    )
[1,28]<stdout>:    (experts): Experts(
[1,28]<stdout>:      (deepspeed_experts): ModuleList(
[1,28]<stdout>:        (0): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (1): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (2): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:        (3): ParallelMLP(
[1,28]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,28]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,28]<stdout>:        )
[1,28]<stdout>:      )
[1,28]<stdout>:    )
[1,28]<stdout>:  )
[1,28]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,31]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 15, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,10]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:local_ep_size = 4
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,28]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4
[1,25]<stdout>:> DeepSpeed Inference initialized
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4
[1,28]<stdout>:local_ep_size = 4
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,29]<stdout>:[2021-12-09 02:31:54,472] [INFO] [engine.py:107:__init__] Place model to device: 5
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,25]<stdout>:NCCL version 2.8.4+cuda11.3
[1,26]<stdout>:[2021-12-09 02:31:54,472] [INFO] [engine.py:107:__init__] Place model to device: 2
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,9]<stdout>:moe, num_experts = True, 4, MoE(
[1,9]<stdout>:  (deepspeed_moe): MOELayer(
[1,9]<stdout>:    (gate): TopKGate(
[1,9]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,9]<stdout>:    )
[1,9]<stdout>:    (experts): Experts(
[1,9]<stdout>:      (deepspeed_experts): ModuleList(
[1,9]<stdout>:        (0): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (1): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (2): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:        (3): ParallelMLP(
[1,9]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,9]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,9]<stdout>:        )
[1,9]<stdout>:      )
[1,9]<stdout>:    )
[1,9]<stdout>:  )
[1,9]<stdout>:), 4
[1,9]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:local_ep_size = 4
[1,8]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:local_ep_size = 4
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,12]<stdout>:moe, num_experts = True, 4, MoE(
[1,12]<stdout>:  (deepspeed_moe): MOELayer(
[1,12]<stdout>:    (gate): TopKGate(
[1,12]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,12]<stdout>:    )
[1,12]<stdout>:    (experts): Experts(
[1,12]<stdout>:      (deepspeed_experts): ModuleList(
[1,12]<stdout>:        (0): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (1): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (2): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:        (3): ParallelMLP(
[1,12]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,12]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,12]<stdout>:        )
[1,12]<stdout>:      )
[1,12]<stdout>:    )
[1,12]<stdout>:  )
[1,12]<stdout>:), 4
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,9]<stdout>:local_ep_size = 4
[1,8]<stdout>:moe, num_experts = True, 4, MoE(
[1,8]<stdout>:  (deepspeed_moe): MOELayer(
[1,8]<stdout>:    (gate): TopKGate(
[1,8]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,8]<stdout>:    )
[1,8]<stdout>:    (experts): Experts(
[1,8]<stdout>:      (deepspeed_experts): ModuleList(
[1,8]<stdout>:        (0): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (1): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (2): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:        (3): ParallelMLP(
[1,8]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,8]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,8]<stdout>:        )
[1,8]<stdout>:      )
[1,8]<stdout>:    )
[1,8]<stdout>:  )
[1,8]<stdout>:), 4
[1,8]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,31]<stdout>:[2021-12-09 02:31:54,478] [INFO] [engine.py:107:__init__] Place model to device: 7
[1,10]<stdout>:[2021-12-09 02:31:54,480] [INFO] [engine.py:107:__init__] Place model to device: 2
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,12]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4
[1,12]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 16, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:[2021-12-09 02:31:54,481] [INFO] [engine.py:107:__init__] Place model to device: 4
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,8]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:> DeepSpeed Inference initialized
[1,8]<stdout>:local_ep_size = 4
[1,15]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,27]<stdout>:NCCL version 2.8.4+cuda11.3
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,11]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:moe, num_experts = True, 4, MoE(
[1,15]<stdout>:  (deepspeed_moe): MOELayer(
[1,15]<stdout>:    (gate): TopKGate(
[1,15]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,15]<stdout>:    )
[1,15]<stdout>:    (experts): Experts(
[1,15]<stdout>:      (deepspeed_experts): ModuleList(
[1,15]<stdout>:        (0): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (1): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (2): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:        (3): ParallelMLP(
[1,15]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,15]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,15]<stdout>:        )
[1,15]<stdout>:      )
[1,15]<stdout>:    )
[1,15]<stdout>:  )
[1,15]<stdout>:), 4
[1,15]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 17, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,9]<stdout>:[2021-12-09 02:31:54,488] [INFO] [engine.py:107:__init__] Place model to device: 1
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,11]<stdout>:moe, num_experts = True, 4, MoE(
[1,11]<stdout>:  (deepspeed_moe): MOELayer(
[1,11]<stdout>:    (gate): TopKGate(
[1,11]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,11]<stdout>:    )
[1,11]<stdout>:    (experts): Experts(
[1,11]<stdout>:      (deepspeed_experts): ModuleList(
[1,11]<stdout>:        (0): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (1): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (2): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:        (3): ParallelMLP(
[1,11]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,11]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,11]<stdout>:        )
[1,11]<stdout>:      )
[1,11]<stdout>:    )
[1,11]<stdout>:  )
[1,11]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:local_ep_size = 4
[1,11]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:local_ep_size = 4
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,12]<stdout>:[2021-12-09 02:31:54,491] [INFO] [engine.py:107:__init__] Place model to device: 4
[1,13]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:moe, num_experts = True, 4, MoE(
[1,14]<stdout>:  (deepspeed_moe): MOELayer(
[1,14]<stdout>:    (gate): TopKGate(
[1,14]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,14]<stdout>:    )
[1,14]<stdout>:    (experts): Experts(
[1,14]<stdout>:      (deepspeed_experts): ModuleList(
[1,14]<stdout>:        (0): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (1): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (2): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:        (3): ParallelMLP(
[1,14]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,14]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,14]<stdout>:        )
[1,14]<stdout>:      )
[1,14]<stdout>:    )
[1,14]<stdout>:  )
[1,14]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,11]<stdout>:local_ep_size = 4
[1,19]<stdout>:local_ep_size = 4
[1,8]<stdout>:[2021-12-09 02:31:54,493] [INFO] [engine.py:107:__init__] Place model to device: 0
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,10]<stdout>:> DeepSpeed Inference initialized
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,14]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:local_ep_size = 4
[1,10]<stdout>:NCCL version 2.8.4+cuda11.3
[1,29]<stdout>:> DeepSpeed Inference initialized
[1,26]<stdout>:> DeepSpeed Inference initialized
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 18, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,26]<stdout>:NCCL version 2.8.4+cuda11.3
[1,29]<stdout>:NCCL version 2.8.4+cuda11.3
[1,22]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,15]<stdout>:[2021-12-09 02:31:54,500] [INFO] [engine.py:107:__init__] Place model to device: 7
[1,31]<stdout>:> DeepSpeed Inference initialized
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,31]<stdout>:NCCL version 2.8.4+cuda11.3
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,28]<stdout>:> DeepSpeed Inference initialized
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,13]<stdout>:moe, num_experts = True, 4, MoE(
[1,13]<stdout>:  (deepspeed_moe): MOELayer(
[1,13]<stdout>:    (gate): TopKGate(
[1,13]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,13]<stdout>:    )
[1,13]<stdout>:    (experts): Experts(
[1,13]<stdout>:      (deepspeed_experts): ModuleList(
[1,13]<stdout>:        (0): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (1): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (2): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:        (3): ParallelMLP(
[1,13]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,13]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,13]<stdout>:        )
[1,13]<stdout>:      )
[1,13]<stdout>:    )
[1,13]<stdout>:  )
[1,13]<stdout>:), 4
[1,9]<stdout>:> DeepSpeed Inference initialized
[1,11]<stdout>:[2021-12-09 02:31:54,503] [INFO] [engine.py:107:__init__] Place model to device: 3
[1,13]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,28]<stdout>:NCCL version 2.8.4+cuda11.3
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,9]<stdout>:NCCL version 2.8.4+cuda11.3
[1,20]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 19, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4
[1,13]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,14]<stdout>:[2021-12-09 02:31:54,507] [INFO] [engine.py:107:__init__] Place model to device: 6
[1,13]<stdout>:local_ep_size = 4
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,17]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 20, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,13]<stdout>:[2021-12-09 02:31:54,518] [INFO] [engine.py:107:__init__] Place model to device: 5
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 21, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:local_ep_size = 4
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 22, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,12]<stdout>:> DeepSpeed Inference initialized
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,8]<stdout>:> DeepSpeed Inference initialized
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,15]<stdout>:> DeepSpeed Inference initialized
[1,14]<stdout>:> DeepSpeed Inference initialized
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,11]<stdout>:> DeepSpeed Inference initialized
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,13]<stdout>:> DeepSpeed Inference initialized
[1,12]<stdout>:NCCL version 2.8.4+cuda11.3
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,8]<stdout>:NCCL version 2.8.4+cuda11.3
[1,15]<stdout>:NCCL version 2.8.4+cuda11.3
[1,14]<stdout>:NCCL version 2.8.4+cuda11.3
[1,11]<stdout>:NCCL version 2.8.4+cuda11.3
[1,13]<stdout>:NCCL version 2.8.4+cuda11.3
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 23, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,18]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 24, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4
[1,23]<stdout>:local_ep_size = 4
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 25, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 26, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:local_ep_size = 4
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 27, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,17]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 28, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 29, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:local_ep_size = 4
[1,20]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 30, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,20]<stdout>:moe, num_experts = True, 4, MoE(
[1,20]<stdout>:  (deepspeed_moe): MOELayer(
[1,20]<stdout>:    (gate): TopKGate(
[1,20]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,20]<stdout>:    )
[1,20]<stdout>:    (experts): Experts(
[1,20]<stdout>:      (deepspeed_experts): ModuleList(
[1,20]<stdout>:        (0): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (1): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (2): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:        (3): ParallelMLP(
[1,20]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,20]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,20]<stdout>:        )
[1,20]<stdout>:      )
[1,20]<stdout>:    )
[1,20]<stdout>:  )
[1,20]<stdout>:), 4
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,18]<stdout>:moe, num_experts = True, 4, MoE(
[1,18]<stdout>:  (deepspeed_moe): MOELayer(
[1,18]<stdout>:    (gate): TopKGate(
[1,18]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,18]<stdout>:    )
[1,18]<stdout>:    (experts): Experts(
[1,18]<stdout>:      (deepspeed_experts): ModuleList(
[1,18]<stdout>:        (0): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (1): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (2): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:        (3): ParallelMLP(
[1,18]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,18]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,18]<stdout>:        )
[1,18]<stdout>:      )
[1,18]<stdout>:    )
[1,18]<stdout>:  )
[1,18]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,20]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:local_ep_size = 4
[1,18]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,18]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 31, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,20]<stdout>:[2021-12-09 02:31:54,622] [INFO] [engine.py:107:__init__] Place model to device: 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 32, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,18]<stdout>:[2021-12-09 02:31:54,623] [INFO] [engine.py:107:__init__] Place model to device: 2
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,19]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 33, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,17]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:moe, num_experts = True, 4, MoE(
[1,22]<stdout>:  (deepspeed_moe): MOELayer(
[1,22]<stdout>:    (gate): TopKGate(
[1,22]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,22]<stdout>:    )
[1,22]<stdout>:    (experts): Experts(
[1,22]<stdout>:      (deepspeed_experts): ModuleList(
[1,22]<stdout>:        (0): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (1): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (2): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:        (3): ParallelMLP(
[1,22]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,22]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,22]<stdout>:        )
[1,22]<stdout>:      )
[1,22]<stdout>:    )
[1,22]<stdout>:  )
[1,22]<stdout>:), 4
[1,22]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,19]<stdout>:moe, num_experts = True, 4, MoE(
[1,19]<stdout>:  (deepspeed_moe): MOELayer(
[1,19]<stdout>:    (gate): TopKGate(
[1,19]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,19]<stdout>:    )
[1,19]<stdout>:    (experts): Experts(
[1,19]<stdout>:      (deepspeed_experts): ModuleList(
[1,19]<stdout>:        (0): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (1): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (2): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:        (3): ParallelMLP(
[1,19]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,19]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,19]<stdout>:        )
[1,19]<stdout>:      )
[1,19]<stdout>:    )
[1,19]<stdout>:  )
[1,19]<stdout>:), 4
[1,19]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:local_ep_size = 4
[1,20]<stdout>:> DeepSpeed Inference initialized
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 34, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,22]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,22]<stdout>:local_ep_size = 4
[1,18]<stdout>:> DeepSpeed Inference initialized
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,20]<stdout>:NCCL version 2.8.4+cuda11.3
[1,19]<stdout>:local_ep_size = 4
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,18]<stdout>:NCCL version 2.8.4+cuda11.3
[1,16]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 35, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,22]<stdout>:[2021-12-09 02:31:54,649] [INFO] [engine.py:107:__init__] Place model to device: 6
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,19]<stdout>:[2021-12-09 02:31:54,651] [INFO] [engine.py:107:__init__] Place model to device: 3
[1,16]<stdout>:moe, num_experts = True, 4, MoE(
[1,16]<stdout>:  (deepspeed_moe): MOELayer(
[1,16]<stdout>:    (gate): TopKGate(
[1,16]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,16]<stdout>:    )
[1,16]<stdout>:    (experts): Experts(
[1,16]<stdout>:      (deepspeed_experts): ModuleList(
[1,16]<stdout>:        (0): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (1): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (2): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:        (3): ParallelMLP(
[1,16]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,16]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,16]<stdout>:        )
[1,16]<stdout>:      )
[1,16]<stdout>:    )
[1,16]<stdout>:  )
[1,16]<stdout>:), 4
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 36, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,16]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,16]<stdout>:local_ep_size = 4
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,17]<stdout>:moe, num_experts = True, 4, MoE(
[1,17]<stdout>:  (deepspeed_moe): MOELayer(
[1,17]<stdout>:    (gate): TopKGate(
[1,17]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,17]<stdout>:    )
[1,17]<stdout>:    (experts): Experts(
[1,17]<stdout>:      (deepspeed_experts): ModuleList(
[1,17]<stdout>:        (0): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (1): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (2): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:        (3): ParallelMLP(
[1,17]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,17]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,17]<stdout>:        )
[1,17]<stdout>:      )
[1,17]<stdout>:    )
[1,17]<stdout>:  )
[1,17]<stdout>:), 4
[1,17]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 37, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,23]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,17]<stdout>:local_ep_size = 4
[1,23]<stdout>:moe, num_experts = True, 4, MoE(
[1,23]<stdout>:  (deepspeed_moe): MOELayer(
[1,23]<stdout>:    (gate): TopKGate(
[1,23]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,23]<stdout>:    )
[1,23]<stdout>:    (experts): Experts(
[1,23]<stdout>:      (deepspeed_experts): ModuleList(
[1,23]<stdout>:        (0): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (1): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (2): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:        (3): ParallelMLP(
[1,23]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,23]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,23]<stdout>:        )
[1,23]<stdout>:      )
[1,23]<stdout>:    )
[1,23]<stdout>:  )
[1,23]<stdout>:), 4
[1,23]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,16]<stdout>:[2021-12-09 02:31:54,667] [INFO] [engine.py:107:__init__] Place model to device: 0
[1,23]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,23]<stdout>:local_ep_size = 4
[1,21]<stdout>:DeepSpeed Transformer Inference config is  {'layer_id': 38, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 1, 'return_tuple': False, 'specialized_mode': False}
[1,17]<stdout>:[2021-12-09 02:31:54,673] [INFO] [engine.py:107:__init__] Place model to device: 1
[1,21]<stdout>:moe, num_experts = True, 4, MoE(
[1,21]<stdout>:  (deepspeed_moe): MOELayer(
[1,21]<stdout>:    (gate): TopKGate(
[1,21]<stdout>:      (wg): Linear(in_features=4096, out_features=128, bias=False)
[1,21]<stdout>:    )
[1,21]<stdout>:    (experts): Experts(
[1,21]<stdout>:      (deepspeed_experts): ModuleList(
[1,21]<stdout>:        (0): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (1): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (2): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:        (3): ParallelMLP(
[1,21]<stdout>:          (dense_h_to_4h): ColumnParallelLinear()
[1,21]<stdout>:          (dense_4h_to_h): RowParallelLinear()
[1,21]<stdout>:        )
[1,21]<stdout>:      )
[1,21]<stdout>:    )
[1,21]<stdout>:  )
[1,21]<stdout>:), 4
[1,21]<stdout>:local_ep_size = 4, ep_world_size = 32, ep_grou = None
[1,21]<stdout>:DeepSpeed MoE Transformer Inference config is  {'layer_id': 39, 'hidden_size': 4096, 'intermediate_size': 16384, 'heads': 32, 'num_hidden_layers': -1, 'fp16': True, 'pre_layer_norm': True, 'local_rank': -1, 'stochastic_mode': False, 'epsilon': 1e-12, 'mp_size': 1, 'q_int8': False, 'scale_attention': True, 'triangular_masking': True, 'local_attention': False, 'window_size': 256, 'return_tuple': True, 'specialized_mode': False, 'moe_experts': 4, 'k': 1, 'capacity_factor': 1.0, 'eval_capacity_factor': 1.0, 'min_capacity': 1, 'noisy_gate_policy': None, 'drop_tokens': True, 'use_rts': False, 'global_experts': 128}
[1,21]<stdout>:local_ep_size = 4
[1,23]<stdout>:[2021-12-09 02:31:54,680] [INFO] [engine.py:107:__init__] Place model to device: 7
[1,22]<stdout>:> DeepSpeed Inference initialized
[1,19]<stdout>:> DeepSpeed Inference initialized
[1,22]<stdout>:NCCL version 2.8.4+cuda11.3
[1,19]<stdout>:NCCL version 2.8.4+cuda11.3
[1,21]<stdout>:[2021-12-09 02:31:54,687] [INFO] [engine.py:107:__init__] Place model to device: 5
[1,16]<stdout>:> DeepSpeed Inference initialized
[1,16]<stdout>:NCCL version 2.8.4+cuda11.3
[1,17]<stdout>:> DeepSpeed Inference initialized
[1,17]<stdout>:NCCL version 2.8.4+cuda11.3
[1,23]<stdout>:> DeepSpeed Inference initialized
[1,23]<stdout>:NCCL version 2.8.4+cuda11.3
[1,21]<stdout>:> DeepSpeed Inference initialized
[1,21]<stdout>:NCCL version 2.8.4+cuda11.3
[1,4]<stdout>:
[1,4]<stdout>:webxt6cb30000A2:66780:67355 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,4]<stdout>:
[1,4]<stdout>:webxt6cb30000A2:66780:67355 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,2]<stdout>:
[1,2]<stdout>:webxt6cb30000A2:66778:67358 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,2]<stdout>:
[1,2]<stdout>:webxt6cb30000A2:66778:67358 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,6]<stdout>:
[1,6]<stdout>:webxt6cb30000A2:66782:67361 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,6]<stdout>:
[1,6]<stdout>:webxt6cb30000A2:66782:67361 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,0]<stdout>:
[1,0]<stdout>:webxt6cb30000A2:66776:67364 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,0]<stdout>:
[1,0]<stdout>:webxt6cb30000A2:66776:67364 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,5]<stdout>:
[1,5]<stdout>:webxt6cb30000A2:66781:67367 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,5]<stdout>:
[1,5]<stdout>:webxt6cb30000A2:66781:67367 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,3]<stdout>:
[1,3]<stdout>:webxt6cb30000A2:66779:67370 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,3]<stdout>:
[1,3]<stdout>:webxt6cb30000A2:66779:67370 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,1]<stdout>:
[1,1]<stdout>:webxt6cb30000A2:66777:67373 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,1]<stdout>:
[1,1]<stdout>:webxt6cb30000A2:66777:67373 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,7]<stdout>:
[1,7]<stdout>:webxt6cb30000A2:66783:67376 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,7]<stdout>:
[1,7]<stdout>:webxt6cb30000A2:66783:67376 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,24]<stdout>:
[1,24]<stdout>:webxt6cb300008U:42178:42685 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,24]<stdout>:
[1,24]<stdout>:webxt6cb300008U:42178:42685 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,10]<stdout>:
[1,10]<stdout>:webxt6cb300009V:71262:71755 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,10]<stdout>:
[1,10]<stdout>:webxt6cb300009V:71262:71755 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,30]<stdout>:
[1,30]<stdout>:webxt6cb300008U:42184:42688 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,30]<stdout>:
[1,30]<stdout>:webxt6cb300008U:42184:42688 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,9]<stdout>:
[1,9]<stdout>:webxt6cb300009V:71261:71758 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,9]<stdout>:
[1,9]<stdout>:webxt6cb300009V:71261:71758 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,12]<stdout>:
[1,12]<stdout>:webxt6cb300009V:71264:71761 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,12]<stdout>:
[1,12]<stdout>:webxt6cb300009V:71264:71761 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,29]<stdout>:
[1,29]<stdout>:webxt6cb300008U:42183:42696 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,29]<stdout>:
[1,29]<stdout>:webxt6cb300008U:42183:42696 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,8]<stdout>:
[1,8]<stdout>:webxt6cb300009V:71260:71765 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,8]<stdout>:
[1,8]<stdout>:webxt6cb300009V:71260:71765 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,26]<stdout>:
[1,26]<stdout>:webxt6cb300008U:42180:42697 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,26]<stdout>:
[1,26]<stdout>:webxt6cb300008U:42180:42697 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,15]<stdout>:
[1,15]<stdout>:webxt6cb300009V:71267:71769 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,15]<stdout>:
[1,15]<stdout>:webxt6cb300009V:71267:71769 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,27]<stdout>:
[1,27]<stdout>:webxt6cb300008U:42181:42692 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,27]<stdout>:
[1,27]<stdout>:webxt6cb300008U:42181:42692 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,14]<stdout>:
[1,14]<stdout>:webxt6cb300009V:71266:71770 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,14]<stdout>:
[1,14]<stdout>:webxt6cb300009V:71266:71770 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,25]<stdout>:
[1,25]<stdout>:webxt6cb300008U:42179:42690 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,25]<stdout>:
[1,25]<stdout>:webxt6cb300008U:42179:42690 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,13]<stdout>:
[1,13]<stdout>:webxt6cb300009V:71265:71772 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,13]<stdout>:
[1,13]<stdout>:webxt6cb300009V:71265:71772 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,31]<stdout>:
[1,31]<stdout>:webxt6cb300008U:42185:42701 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,31]<stdout>:
[1,31]<stdout>:webxt6cb300008U:42185:42701 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,11]<stdout>:
[1,11]<stdout>:webxt6cb300009V:71263:71771 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,11]<stdout>:
[1,11]<stdout>:webxt6cb300009V:71263:71771 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,28]<stdout>:
[1,28]<stdout>:webxt6cb300008U:42182:42704 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,28]<stdout>:
[1,28]<stdout>:webxt6cb300008U:42182:42704 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,20]<stdout>:
[1,20]<stdout>:webxt6cb30000AB:42220:42751 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,20]<stdout>:
[1,20]<stdout>:webxt6cb30000AB:42220:42751 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,18]<stdout>:
[1,18]<stdout>:webxt6cb30000AB:42218:42753 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,18]<stdout>:
[1,18]<stdout>:webxt6cb30000AB:42218:42753 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,22]<stdout>:
[1,22]<stdout>:webxt6cb30000AB:42222:42758 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,22]<stdout>:
[1,22]<stdout>:webxt6cb30000AB:42222:42758 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,19]<stdout>:
[1,19]<stdout>:webxt6cb30000AB:42219:42759 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,19]<stdout>:
[1,19]<stdout>:webxt6cb30000AB:42219:42759 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,17]<stdout>:
[1,17]<stdout>:webxt6cb30000AB:42217:42766 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,17]<stdout>:
[1,17]<stdout>:webxt6cb30000AB:42217:42766 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,23]<stdout>:
[1,23]<stdout>:webxt6cb30000AB:42223:42769 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,23]<stdout>:
[1,23]<stdout>:webxt6cb30000AB:42223:42769 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,16]<stdout>:
[1,16]<stdout>:webxt6cb30000AB:42216:42763 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,16]<stdout>:
[1,16]<stdout>:webxt6cb30000AB:42216:42763 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,21]<stdout>:
[1,21]<stdout>:webxt6cb30000AB:42221:42772 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,21]<stdout>:
[1,21]<stdout>:webxt6cb30000AB:42221:42772 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,4]<stdout>:test: range(0, 32)
[1,6]<stdout>:test: range(0, 32)
[1,2]<stdout>:test: range(0, 32)
[1,0]<stdout>:test: range(0, 32)
[1,3]<stdout>:test: range(0, 32)
[1,5]<stdout>:test: range(0, 32)
[1,7]<stdout>:test: range(0, 32)
[1,1]<stdout>:test: range(0, 32)
[1,10]<stdout>:test: range(0, 32)
[1,12]<stdout>:test: range(0, 32)
[1,30]<stdout>:test: range(0, 32)
[1,24]<stdout>:test: range(0, 32)
[1,9]<stdout>:test: range(0, 32)
[1,8]<stdout>:test: range(0, 32)
[1,15]<stdout>:test: range(0, 32)
[1,29]<stdout>:test: range(0, 32)
[1,14]<stdout>:test: range(0, 32)
[1,13]<stdout>:test: range(0, 32)
[1,25]<stdout>:test: range(0, 32)
[1,27]<stdout>:test: range(0, 32)
[1,11]<stdout>:test: range(0, 32)
[1,31]<stdout>:test: range(0, 32)
[1,26]<stdout>:test: range(0, 32)
[1,28]<stdout>:test: range(0, 32)
[1,20]<stdout>:test: range(0, 32)
[1,18]<stdout>:test: range(0, 32)
[1,22]<stdout>:test: range(0, 32)
[1,17]<stdout>:test: range(0, 32)
[1,16]<stdout>:test: range(0, 32)
[1,19]<stdout>:test: range(0, 32)
[1,21]<stdout>:test: range(0, 32)
[1,23]<stdout>:test: range(0, 32)
[1,6]<stdout>:
[1,6]<stdout>:webxt6cb30000A2:66782:67424 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,6]<stdout>:
[1,6]<stdout>:webxt6cb30000A2:66782:67424 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,1]<stdout>:
[1,1]<stdout>:webxt6cb30000A2:66777:67429 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,1]<stdout>:
[1,1]<stdout>:webxt6cb30000A2:66777:67429 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,17]<stdout>:
[1,17]<stdout>:webxt6cb30000AB:42217:42821 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,17]<stdout>:
[1,17]<stdout>:webxt6cb30000AB:42217:42821 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,4]<stdout>:
[1,4]<stdout>:webxt6cb30000A2:66780:67425 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,4]<stdout>:
[1,4]<stdout>:webxt6cb30000A2:66780:67425 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,5]<stdout>:
[1,5]<stdout>:webxt6cb30000A2:66781:67428 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,5]<stdout>:
[1,5]<stdout>:webxt6cb30000A2:66781:67428 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,28]<stdout>:
[1,28]<stdout>:webxt6cb300008U:42182:42757 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,28]<stdout>:
[1,28]<stdout>:webxt6cb300008U:42182:42757 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,16]<stdout>:
[1,16]<stdout>:webxt6cb30000AB:42216:42819 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,16]<stdout>:
[1,16]<stdout>:webxt6cb30000AB:42216:42819 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,7]<stdout>:
[1,7]<stdout>:webxt6cb30000A2:66783:67423 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,7]<stdout>:
[1,7]<stdout>:webxt6cb30000A2:66783:67423 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,23]<stdout>:
[1,23]<stdout>:webxt6cb30000AB:42223:42823 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,23]<stdout>:
[1,23]<stdout>:webxt6cb30000AB:42223:42823 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,26]<stdout>:
[1,26]<stdout>:webxt6cb300008U:42180:42756 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,26]<stdout>:
[1,26]<stdout>:webxt6cb300008U:42180:42756 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,0]<stdout>:
[1,0]<stdout>:webxt6cb30000A2:66776:67427 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,0]<stdout>:
[1,0]<stdout>:webxt6cb30000A2:66776:67427 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,3]<stdout>:
[1,3]<stdout>:webxt6cb30000A2:66779:67430 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,3]<stdout>:
[1,3]<stdout>:webxt6cb30000A2:66779:67430 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,21]<stdout>:
[1,21]<stdout>:webxt6cb30000AB:42221:42824 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,21]<stdout>:
[1,21]<stdout>:webxt6cb30000AB:42221:42824 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,2]<stdout>:
[1,2]<stdout>:webxt6cb30000A2:66778:67431 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,2]<stdout>:
[1,2]<stdout>:webxt6cb30000A2:66778:67431 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,30]<stdout>:
[1,30]<stdout>:webxt6cb300008U:42184:42754 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,30]<stdout>:
[1,30]<stdout>:webxt6cb300008U:42184:42754 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,19]<stdout>:
[1,19]<stdout>:webxt6cb30000AB:42219:42820 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,19]<stdout>:
[1,19]<stdout>:webxt6cb30000AB:42219:42820 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,25]<stdout>:
[1,25]<stdout>:webxt6cb300008U:42179:42755 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,25]<stdout>:
[1,25]<stdout>:webxt6cb300008U:42179:42755 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,20]<stdout>:
[1,20]<stdout>:webxt6cb30000AB:42220:42827 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,20]<stdout>:
[1,20]<stdout>:webxt6cb30000AB:42220:42827 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,29]<stdout>:
[1,29]<stdout>:webxt6cb300008U:42183:42758 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,29]<stdout>:
[1,29]<stdout>:webxt6cb300008U:42183:42758 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,18]<stdout>:
[1,18]<stdout>:webxt6cb30000AB:42218:42826 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,18]<stdout>:
[1,18]<stdout>:webxt6cb30000AB:42218:42826 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,22]<stdout>:
[1,22]<stdout>:webxt6cb30000AB:42222:42822 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,22]<stdout>:
[1,22]<stdout>:webxt6cb30000AB:42222:42822 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,24]<stdout>:
[1,24]<stdout>:webxt6cb300008U:42178:42759 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,24]<stdout>:
[1,24]<stdout>:webxt6cb300008U:42178:42759 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,27]<stdout>:
[1,27]<stdout>:webxt6cb300008U:42181:42761 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,27]<stdout>:
[1,27]<stdout>:webxt6cb300008U:42181:42761 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,31]<stdout>:
[1,31]<stdout>:webxt6cb300008U:42185:42760 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,31]<stdout>:
[1,31]<stdout>:webxt6cb300008U:42185:42760 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,13]<stdout>:
[1,13]<stdout>:webxt6cb300009V:71265:71827 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,13]<stdout>:
[1,13]<stdout>:webxt6cb300009V:71265:71827 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,8]<stdout>:
[1,8]<stdout>:webxt6cb300009V:71260:71825 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,8]<stdout>:
[1,8]<stdout>:webxt6cb300009V:71260:71825 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,12]<stdout>:
[1,12]<stdout>:webxt6cb300009V:71264:71824 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,12]<stdout>:
[1,12]<stdout>:webxt6cb300009V:71264:71824 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,14]<stdout>:
[1,14]<stdout>:webxt6cb300009V:71266:71828 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,14]<stdout>:
[1,14]<stdout>:webxt6cb300009V:71266:71828 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,10]<stdout>:
[1,10]<stdout>:webxt6cb300009V:71262:71829 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,10]<stdout>:
[1,10]<stdout>:webxt6cb300009V:71262:71829 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,9]<stdout>:
[1,9]<stdout>:webxt6cb300009V:71261:71826 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,9]<stdout>:
[1,9]<stdout>:webxt6cb300009V:71261:71826 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,15]<stdout>:
[1,15]<stdout>:webxt6cb300009V:71267:71831 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,15]<stdout>:
[1,15]<stdout>:webxt6cb300009V:71267:71831 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,11]<stdout>:
[1,11]<stdout>:webxt6cb300009V:71263:71830 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,11]<stdout>:
[1,11]<stdout>:webxt6cb300009V:71263:71830 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,6]<stdout>:
[1,6]<stdout>:webxt6cb30000A2:66782:67444 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,6]<stdout>:
[1,6]<stdout>:webxt6cb30000A2:66782:67444 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,1]<stdout>:
[1,1]<stdout>:webxt6cb30000A2:66777:67447 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,1]<stdout>:
[1,1]<stdout>:webxt6cb30000A2:66777:67447 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,4]<stdout>:
[1,4]<stdout>:webxt6cb30000A2:66780:67451 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,4]<stdout>:
[1,4]<stdout>:webxt6cb30000A2:66780:67451 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,5]<stdout>:
[1,5]<stdout>:webxt6cb30000A2:66781:67455 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,5]<stdout>:
[1,5]<stdout>:webxt6cb30000A2:66781:67455 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,17]<stdout>:
[1,17]<stdout>:webxt6cb30000AB:42217:42840 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,17]<stdout>:
[1,17]<stdout>:webxt6cb30000AB:42217:42840 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,7]<stdout>:
[1,7]<stdout>:webxt6cb30000A2:66783:67458 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,7]<stdout>:
[1,7]<stdout>:webxt6cb30000A2:66783:67458 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,0]<stdout>:
[1,0]<stdout>:webxt6cb30000A2:66776:67462 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,0]<stdout>:
[1,0]<stdout>:webxt6cb30000A2:66776:67462 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,16]<stdout>:
[1,16]<stdout>:webxt6cb30000AB:42216:42843 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,16]<stdout>:
[1,16]<stdout>:webxt6cb30000AB:42216:42843 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,3]<stdout>:
[1,3]<stdout>:webxt6cb30000A2:66779:67467 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,3]<stdout>:
[1,3]<stdout>:webxt6cb30000A2:66779:67467 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,23]<stdout>:
[1,23]<stdout>:webxt6cb30000AB:42223:42847 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,23]<stdout>:
[1,23]<stdout>:webxt6cb30000AB:42223:42847 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,2]<stdout>:
[1,2]<stdout>:webxt6cb30000A2:66778:67470 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,2]<stdout>:
[1,2]<stdout>:webxt6cb30000A2:66778:67470 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,28]<stdout>:
[1,28]<stdout>:webxt6cb300008U:42182:42773 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,28]<stdout>:
[1,28]<stdout>:webxt6cb300008U:42182:42773 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,26]<stdout>:
[1,26]<stdout>:webxt6cb300008U:42180:42777 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,26]<stdout>:
[1,26]<stdout>:webxt6cb300008U:42180:42777 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,21]<stdout>:
[1,21]<stdout>:webxt6cb30000AB:42221:42851 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,21]<stdout>:
[1,21]<stdout>:webxt6cb30000AB:42221:42851 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,19]<stdout>:
[1,19]<stdout>:webxt6cb30000AB:42219:42854 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,19]<stdout>:
[1,19]<stdout>:webxt6cb30000AB:42219:42854 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,30]<stdout>:
[1,30]<stdout>:webxt6cb300008U:42184:42781 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,30]<stdout>:
[1,30]<stdout>:webxt6cb300008U:42184:42781 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,20]<stdout>:
[1,20]<stdout>:webxt6cb30000AB:42220:42858 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,20]<stdout>:
[1,20]<stdout>:webxt6cb30000AB:42220:42858 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,18]<stdout>:
[1,18]<stdout>:webxt6cb30000AB:42218:42862 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,18]<stdout>:
[1,18]<stdout>:webxt6cb30000AB:42218:42862 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,25]<stdout>:
[1,25]<stdout>:webxt6cb300008U:42179:42784 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,25]<stdout>:
[1,25]<stdout>:webxt6cb300008U:42179:42784 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,22]<stdout>:
[1,22]<stdout>:webxt6cb30000AB:42222:42866 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,22]<stdout>:
[1,22]<stdout>:webxt6cb30000AB:42222:42866 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,29]<stdout>:
[1,29]<stdout>:webxt6cb300008U:42183:42788 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,29]<stdout>:
[1,29]<stdout>:webxt6cb300008U:42183:42788 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,24]<stdout>:
[1,24]<stdout>:webxt6cb300008U:42178:42792 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,24]<stdout>:
[1,24]<stdout>:webxt6cb300008U:42178:42792 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,27]<stdout>:
[1,27]<stdout>:webxt6cb300008U:42181:42797 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,27]<stdout>:
[1,27]<stdout>:webxt6cb300008U:42181:42797 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,31]<stdout>:
[1,31]<stdout>:webxt6cb300008U:42185:42800 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,31]<stdout>:
[1,31]<stdout>:webxt6cb300008U:42185:42800 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,13]<stdout>:
[1,13]<stdout>:webxt6cb300009V:71265:71843 [5] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,13]<stdout>:
[1,13]<stdout>:webxt6cb300009V:71265:71843 [5] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,8]<stdout>:
[1,8]<stdout>:webxt6cb300009V:71260:71847 [0] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,8]<stdout>:
[1,8]<stdout>:webxt6cb300009V:71260:71847 [0] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,12]<stdout>:
[1,12]<stdout>:webxt6cb300009V:71264:71851 [4] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,12]<stdout>:
[1,12]<stdout>:webxt6cb300009V:71264:71851 [4] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,14]<stdout>:
[1,14]<stdout>:webxt6cb300009V:71266:71855 [6] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,14]<stdout>:
[1,14]<stdout>:webxt6cb300009V:71266:71855 [6] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,10]<stdout>:
[1,10]<stdout>:webxt6cb300009V:71262:71858 [2] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,10]<stdout>:
[1,10]<stdout>:webxt6cb300009V:71262:71858 [2] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,9]<stdout>:
[1,9]<stdout>:webxt6cb300009V:71261:71862 [1] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,9]<stdout>:
[1,9]<stdout>:webxt6cb300009V:71261:71862 [1] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,15]<stdout>:
[1,15]<stdout>:webxt6cb300009V:71267:71867 [7] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,15]<stdout>:
[1,15]<stdout>:webxt6cb300009V:71267:71867 [7] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,11]<stdout>:
[1,11]<stdout>:webxt6cb300009V:71263:71870 [3] graph/topo.cc:675 NCCL WARN SCCL: ngpus set in the SCCL algo (32) doesn't match the communicator ngpus (1)
[1,11]<stdout>:
[1,11]<stdout>:webxt6cb300009V:71263:71870 [3] graph/topo.cc:1036 NCCL WARN SCCL: algorithm /home/amawa/a2a-32.xml failed to initialize. Will be ignored.
[1,0]<stdout>:====== latency stats {0} ====== 
[1,0]<stdout>:	Avg Latency:  1051.58 ms
[1,0]<stdout>:	P50 Latency:  1050.26 ms
[1,0]<stdout>:	P90 Latency:  1054.44 ms
[1,0]<stdout>:	P95 Latency:  1054.44 ms
[1,0]<stdout>:	P99 Latency:  1054.44 ms
[1,0]<stdout>:	999 Latency:  1054.44 ms
[1,0]<stdout>:====== latency stats {0} ====== model_latencies
[1,0]<stdout>:	Avg Latency:    34.59 ms
[1,0]<stdout>:	P50 Latency:    34.47 ms
[1,0]<stdout>:	P90 Latency:    35.04 ms
[1,0]<stdout>:	P95 Latency:    35.40 ms
[1,0]<stdout>:	P99 Latency:    36.39 ms
[1,0]<stdout>:	999 Latency:    37.50 ms
[1,0]<stdout>:====== latency stats {0} ====== single_token_latency
[1,0]<stdout>:	Avg Latency:    36.23 ms
[1,0]<stdout>:	P50 Latency:    36.11 ms
[1,0]<stdout>:	P90 Latency:    36.68 ms
[1,0]<stdout>:	P95 Latency:    37.02 ms
[1,0]<stdout>:	P99 Latency:    38.03 ms
[1,0]<stdout>:	999 Latency:    39.14 ms
